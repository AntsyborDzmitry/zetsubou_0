{"version":3,"sources":["components/shipment/shipment-type/ewf-shipment-type-controller.js"],"names":[],"mappings":"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","file":"components/shipment/shipment-type/ewf-shipment-type-controller.js","sourcesContent":["import ewf from 'ewf';\r\nimport EwfShipmentStepBaseController from './../ewf-shipment-step-base-controller';\r\nimport './shipment-type-service';\r\n\r\nEwfShipmentTypeController.$inject = ['userService', 'shipmentService', 'shipmentTypeService'];\r\n\r\nEwfShipmentTypeController.prototype = new EwfShipmentStepBaseController('shipment-type');\r\n\r\newf.controller('EwfShipmentTypeController', EwfShipmentTypeController);\r\nexport default function EwfShipmentTypeController(userService, shipmentService, shipmentTypeService) {\r\n    const vm = this;\r\n\r\n    let isStepPassable = false;\r\n    const referenceType = {\r\n        MANDATORY: 'MANDATORY',\r\n        DEFAULT: 'DEFAULT',\r\n        OPTIONAL: 'OPTIONAL',\r\n        NEW: 'NEW'\r\n    };\r\n\r\n    Object.assign(vm, {\r\n        onInit,\r\n        onNextClick,\r\n        onEditClick,\r\n        updateShipmentType,\r\n        updateCustomsInvoiceType,\r\n        isNextButtonVisible,\r\n        isEnhancedCustomsInvoiceVisible,\r\n        addReference,\r\n        removeReference,\r\n        pickReference,\r\n        onEdit,\r\n        referencesListVisible,\r\n        isReferenceDisabled,\r\n        isShippingPurposeEmpty,\r\n        getCurrentIncompleteData,\r\n        loadShipmentData,\r\n\r\n        isUserAuthorized: null,\r\n        shipmentType: null,\r\n        additionalReferences: [],\r\n        toContactReferences: [],\r\n        fromContactReferences: [],\r\n        userProfileReferences: [],\r\n        referenceListIsEmpty: true,\r\n        referenceList: [],\r\n        packages: {},\r\n        customsInvoiceType: '',\r\n\r\n        SHIPMENT_TYPE: {\r\n            DOCUMENT: 'DOCUMENT',\r\n            PACKAGE: 'PACKAGE'\r\n        },\r\n        CUSTOMS_INVOICE_TYPE: {\r\n            CREATE: 'CREATE',\r\n            USE: 'USE'\r\n        },\r\n        primaryReference: {\r\n            name: '',\r\n            type: referenceType.NEW\r\n        }\r\n    });\r\n\r\n    const referenceGroup = {\r\n        toContact: 'TO_CONTACT',\r\n        fromContact: 'FROM_CONTACT',\r\n        userProfile: 'USER_PROFILE'\r\n    };\r\n\r\n    let contactsKeys;\r\n\r\n    function onInit() {\r\n        vm.initialized = true;\r\n        vm.isUserAuthorized = userService.isAuthorized();\r\n        contactsKeys = shipmentService.getContactsKeys();\r\n\r\n        if (vm.isUserAuthorized) {\r\n            loadReferenceDetails(contactsKeys);\r\n        } else {\r\n            loadReferenceBehavior();\r\n        }\r\n\r\n        const fromCountry = shipmentService.getShipmentCountry();\r\n        const toCountry = shipmentService.getDestinationCountry();\r\n\r\n        shipmentTypeService.getShipmentParameters(fromCountry, toCountry)\r\n            .then((response) => {\r\n                shipmentService.setCountrySomParameters(\r\n                    response.shipperCountrySom,\r\n                    response.userProfileCountrySom,\r\n                    response.weightConvertionRate,\r\n                    response.dimensionConvertionRate,\r\n                    response.shipperCountryConversionPrecision,\r\n                    response.userProfileCountryConversionPrecision\r\n                );\r\n                shipmentService.setCurrencies(response.currencyList);\r\n\r\n                isStepPassable = true;\r\n            });\r\n    }\r\n\r\n    function loadReferenceBehavior() {\r\n        const countryCode = shipmentService.getShipmentCountry();\r\n\r\n        shipmentTypeService.getReferenceBehavior(countryCode)\r\n            .then(onGetReferenceBehavior)\r\n            .catch(onError);\r\n    }\r\n\r\n    function onGetReferenceBehavior(response) {\r\n        vm.referenceBehavior = response.behavior;\r\n    }\r\n\r\n    function loadReferenceDetails(keys) {\r\n        shipmentTypeService.getReferencesDetails(keys.fromContactKey, keys.toContactKey)\r\n            .then(onGetReferencesDetails)\r\n            .catch(onError);\r\n    }\r\n\r\n    function onGetReferencesDetails(response) {\r\n        vm.primaryReference = {\r\n            name: '',\r\n            type: referenceType.NEW\r\n        };\r\n        vm.additionalReferences = [];\r\n        vm.customReferenceCaption = response.customReferenceCaption;\r\n        vm.referenceList = response.referenceList;\r\n        if (response.referenceMandatory) {\r\n            vm.referenceBehavior = 'mandatory';\r\n        }\r\n        if (response.lastShipmentReferenceList && response.lastShipmentReferenceList.length) {\r\n            vm.primaryReference = response.lastShipmentReferenceList.shift();\r\n            vm.additionalReferences = response.lastShipmentReferenceList.slice();\r\n        } else if (response.referenceList && response.referenceList.length) {\r\n            vm.toContactReferences = [];\r\n            vm.fromContactReferences = [];\r\n            vm.userProfileReferences = [];\r\n\r\n            response.referenceList.forEach((item) => {\r\n                if (item.group === referenceGroup.toContact) {\r\n                    vm.toContactReferences.push(item);\r\n                }\r\n                if (item.group === referenceGroup.fromContact) {\r\n                    vm.fromContactReferences.push(item);\r\n                }\r\n                if (item.group === referenceGroup.userProfile) {\r\n                    vm.userProfileReferences.push(item);\r\n                }\r\n                const emptyReferenceList = !response.lastShipmentReferenceList;\r\n                if (emptyReferenceList && item.type === referenceType.DEFAULT) {\r\n                    if (response.modificationRefused) {\r\n                        item.type = referenceType.MANDATORY;\r\n                    }\r\n                    vm.additionalReferences.push(item);\r\n                }\r\n            });\r\n            vm.referenceListIsEmpty = false;\r\n            vm.primaryReference = vm.additionalReferences.shift() || vm.primaryReference;\r\n        }\r\n    }\r\n\r\n    function getPreparedReferences(primaryReference, additionalReferences) {\r\n        const referenceRows = [primaryReference].concat(additionalReferences);\r\n\r\n        const newReferences = referenceRows\r\n            .filter((referenceFromRow) => referenceFromRow.name)\r\n            .map((referenceFromRow) => ({\r\n                name: referenceFromRow.name,\r\n                group: referenceFromRow.group || 'USER_PROFILE',\r\n                type: referenceFromRow.type || 'NEW'\r\n            }));\r\n\r\n        return newReferences;\r\n    }\r\n\r\n    function setReferences() {\r\n        const references = getPreparedReferences(vm.primaryReference, vm.additionalReferences);\r\n        vm.updateShipmentType();\r\n        shipmentService.setCustomsInvoice();\r\n        shipmentService.setShipmentReferences(references);\r\n    }\r\n\r\n    function onError(error) {\r\n        vm.error = error;\r\n    }\r\n\r\n    function isNextButtonVisible() {\r\n        const isInvoiceTypeDefined = vm.customsInvoiceType in vm.CUSTOMS_INVOICE_TYPE;\r\n\r\n        return vm.shipmentType === vm.SHIPMENT_TYPE.DOCUMENT\r\n            || vm.shipmentType === vm.SHIPMENT_TYPE.PACKAGE && isInvoiceTypeDefined;\r\n    }\r\n\r\n    function isEnhancedCustomsInvoiceVisible() {\r\n        return vm.shipmentType === vm.SHIPMENT_TYPE.PACKAGE && vm.customsInvoiceType === vm.CUSTOMS_INVOICE_TYPE.CREATE;\r\n    }\r\n\r\n    function updateShipmentType(type = vm.shipmentType) {\r\n        shipmentService.setShipmentType(type);\r\n    }\r\n\r\n    function updateCustomsInvoiceType(type) {\r\n        shipmentService.setCustomsInvoiceType(type);\r\n    }\r\n\r\n    function onNextClick(form, ewfFormCtrl) {\r\n        if (vm.shipmentType === vm.SHIPMENT_TYPE.DOCUMENT) {\r\n            if (form.$valid && isStepPassable) {\r\n                setReferences();\r\n                vm.nextCallback();\r\n            } else {\r\n                triggerFieldValidation(form);\r\n            }\r\n        }\r\n\r\n        if (vm.shipmentType === vm.SHIPMENT_TYPE.PACKAGE) {\r\n            if (form.$invalid && ewfFormCtrl.ewfValidation() || !isStepPassable) {\r\n                return;\r\n            }\r\n            vm.updateShipmentType();\r\n            if (vm.customsInvoiceType === vm.CUSTOMS_INVOICE_TYPE.CREATE) {\r\n                setPackagesItemAttributes();\r\n            } else {\r\n                shipmentService.setCustomsInvoice();\r\n                shipmentService.setItar(vm.itarCtrl.getItar());\r\n            }\r\n            vm.nextCallback();\r\n        }\r\n    }\r\n\r\n    function getCurrentIncompleteData() {\r\n        if (vm.shipmentType === vm.SHIPMENT_TYPE.DOCUMENT) {\r\n            setReferences();\r\n        }\r\n\r\n        if (vm.shipmentType === vm.SHIPMENT_TYPE.PACKAGE) {\r\n            vm.updateShipmentType();\r\n            if (vm.customsInvoiceType === vm.CUSTOMS_INVOICE_TYPE.CREATE) {\r\n                setPackagesItemAttributes();\r\n            } else {\r\n                shipmentService.setCustomsInvoice();\r\n                shipmentService.setItar(vm.itarCtrl.getItar());\r\n            }\r\n        }\r\n    }\r\n\r\n    function setPackagesItemAttributes() {\r\n        if (!vm.itemAttrCtrl) {\r\n            return;\r\n        }\r\n\r\n        const itemAttrFormCtrl = vm.itemAttrCtrl.itemAttrFormCtrl;\r\n\r\n        vm.packages = {\r\n            total: itemAttrFormCtrl.itemAttributesModel.totalDeclareValue,\r\n            list: itemAttrFormCtrl.itemAttributesModel.productList\r\n        };\r\n        itemAttrFormCtrl.onNextClick();\r\n        vm.itemAttrCtrl.onNextClick();\r\n    }\r\n\r\n    function onEditClick() {\r\n        //@todo: validate\r\n        vm.editCallback();\r\n    }\r\n\r\n    function onEdit() {\r\n        let newContactKeys = shipmentService.getContactsKeys();\r\n        let isUserAuthorized = userService.isAuthorized();\r\n        if (isUserAuthorized) {\r\n            if (newContactKeys !== contactsKeys) {\r\n                loadReferenceDetails(newContactKeys);\r\n            }\r\n        } else {\r\n            loadReferenceBehavior();\r\n        }\r\n    }\r\n\r\n    function addReference() {\r\n        vm.additionalReferences.push({\r\n            name: ''\r\n        });\r\n    }\r\n\r\n    function removeReference(item) {\r\n        const index = vm.additionalReferences.indexOf(item);\r\n        if (index === -1) {\r\n            return;\r\n        }\r\n\r\n        vm.additionalReferences.splice(index, 1);\r\n    }\r\n\r\n    function pickReference(row, ref) {\r\n        row.name = ref.name;\r\n    }\r\n\r\n    function referencesListVisible(row) {\r\n        if (vm.userProfileReferences.length || vm.fromContactReferences.length || vm.toContactReferences.length) {\r\n            if (row) {\r\n                row.isReferencesListVisible = true;\r\n            } else {\r\n                vm.isReferencesListVisibleForPrimary = true;\r\n            }\r\n        } else {\r\n            if (row) {\r\n                row.isReferencesListVisible = false;\r\n            }\r\n            vm.isReferencesListVisibleForPrimary = false;\r\n        }\r\n    }\r\n\r\n    function triggerFieldValidation(form) {\r\n        form.$error.ewfValid.forEach((field) => {\r\n            field.$dirty = true;\r\n            field.$setViewValue(field.$viewValue);\r\n        });\r\n    }\r\n\r\n    function isReferenceDisabled() {\r\n        return !!vm.primaryReference && vm.primaryReference.type === referenceType.MANDATORY;\r\n    }\r\n\r\n    function isShippingPurposeEmpty() {\r\n        return vm.shipmentType === vm.SHIPMENT_TYPE.PACKAGE\r\n               && vm.customsInvoiceType === vm.CUSTOMS_INVOICE_TYPE.CREATE\r\n               && vm.itemAttrCtrl.shippingPurpose === '';\r\n    }\r\n\r\n    function loadShipmentData(data) {\r\n        Object.assign(vm, shipmentService.getShipmentTypeData(data));\r\n    }\r\n}\r\n"],"sourceRoot":"/source/"}