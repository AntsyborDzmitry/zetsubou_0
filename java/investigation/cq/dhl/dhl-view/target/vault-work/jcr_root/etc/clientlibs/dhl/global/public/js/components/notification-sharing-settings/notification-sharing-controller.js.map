{"version":3,"sources":["components/notification-sharing-settings/notification-sharing-controller.js"],"names":[],"mappings":"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","file":"components/notification-sharing-settings/notification-sharing-controller.js","sourcesContent":["import './../../services/ewf-crud-service';\r\nimport './../../constants/system-settings-constants';\r\nimport './../../services/ewf-spinner-service';\r\n\r\nNotificationSharingController.$inject = [\r\n    '$scope',\r\n    '$timeout',\r\n    'ewfCrudService',\r\n    'systemSettings',\r\n    'ewfSpinnerService'\r\n];\r\n\r\nexport default function NotificationSharingController(\r\n    $scope,\r\n    $timeout,\r\n    ewfCrudService,\r\n    systemSettings,\r\n    ewfSpinnerService) {\r\n    const vm = this;\r\n    const notificationShareListUrl = '/api/myprofile/notification/settings';\r\n    const templatesSupportDataUrl = '/api/myprofile/notification/settings/template/config';\r\n    const sendTestEmailUrl = '/api/myprofile/notification/custom-template/test';\r\n    const emailsMaxLength = 5;\r\n\r\n    let showMore = false;\r\n    let savedEditorHtml;\r\n\r\n    Object.assign(vm, {\r\n        scope: $scope,\r\n        sharingListUpdated: false,\r\n        activeEmailTemplateTab: 'standard',\r\n        emailsCount: 0,\r\n        blockAddBtn: false,\r\n        defaultSettings: {},\r\n        helpOpen: {\r\n            shipStatus: false,\r\n            shipDetails: false\r\n        },\r\n\r\n        init,\r\n        updateSharingList,\r\n        countEmails,\r\n        addEmail,\r\n        blockAddButtonIfEmpty,\r\n        removeEmail,\r\n        rebuildEmails,\r\n        showMoreInfo,\r\n        isMoreInfoShown,\r\n        isActiveTab,\r\n        setActiveTab,\r\n        revertChanges,\r\n        cancelChangesAction,\r\n        setTranslation,\r\n\r\n        templateTagsList: [],\r\n        templateTypesList: [],\r\n        saveTemplate,\r\n        disableTemplateSaving,\r\n        sendTestEmail,\r\n\r\n        mapOptionKey\r\n    });\r\n\r\n    function init() {\r\n        initNotificationSharingList();\r\n        initTemplateTagsList();\r\n    }\r\n\r\n    function initNotificationSharingList() {\r\n        const promise = ewfCrudService.getElementList(notificationShareListUrl)\r\n            .then((sharingList) => {\r\n                vm.sharingList = sharingList;\r\n\r\n                $scope.ckEditorBuffer = $scope.ckEditorTplToHTML(\r\n                    vm.sharingList.shipmentSharingDefaults.customTemplate.templateHtml,\r\n                    vm.templateTagsList\r\n                );\r\n                savedEditorHtml = $scope.ckEditorBuffer;\r\n            })\r\n            .finally(() => {\r\n                vm.countEmails();\r\n                if (!vm.emailsCount) {\r\n                    vm.sharingList.shipmentSharingDefaults.shareDetailsWith.emails[0] = '';\r\n                }\r\n                vm.rebuildEmails();\r\n                vm.defaultSettings = angular.copy(vm.sharingList);\r\n            });\r\n\r\n        return ewfSpinnerService.applySpinner(promise);\r\n    }\r\n\r\n    function initTemplateTagsList() {\r\n        ewfCrudService.getElementList(templatesSupportDataUrl)\r\n            .then((templatesData) => {\r\n                vm.templateTagsList = templatesData.templateTagsList;\r\n                vm.templateTypesList = templatesData.templateTypesList.map(vm.setTranslation);\r\n            });\r\n    }\r\n\r\n    function updateSharingList(sharingListForm, ewfFormCtrl) {\r\n        if (sharingListForm.$invalid && ewfFormCtrl.ewfValidation()) {\r\n            return;\r\n        }\r\n        $timeout.cancel(vm.successMsgTimeout);\r\n\r\n        saveTemplate();\r\n\r\n        ewfCrudService.updateElement(notificationShareListUrl, vm.sharingList)\r\n            .then(sharingListUpdated)\r\n            .finally(() => {\r\n                vm.defaultSettings = angular.copy(vm.sharingList);\r\n            });\r\n    }\r\n\r\n    function sharingListUpdated() {\r\n        vm.sharingListUpdated = true;\r\n        vm.successMsgTimeout = $timeout(() => {\r\n                vm.sharingListUpdated = false;\r\n            },\r\n            systemSettings.showInformationHintTimeout\r\n        );\r\n    }\r\n\r\n    function countEmails() {\r\n        vm.emailsCount = vm.sharingList.shipmentSharingDefaults.shareDetailsWith.emails.length;\r\n    }\r\n\r\n    function addEmail() {\r\n        const lastItem = vm.sharingList.shipmentSharingDefaults.shareDetailsWith.emails[vm.emailsCount - 1];\r\n        if (vm.emailsCount < emailsMaxLength && lastItem) {\r\n            vm.sharingList.shipmentSharingDefaults.shareDetailsWith.emails.push('');\r\n        }\r\n        vm.rebuildEmails();\r\n    }\r\n\r\n    function blockAddButtonIfEmpty() {\r\n        vm.sharingList.shipmentSharingDefaults.shareDetailsWith.emails.forEach((emailItem) => {\r\n            vm.blockAddBtn = (!emailItem || vm.emailsCount >= emailsMaxLength);\r\n        });\r\n    }\r\n\r\n    function removeEmail(indexOfEmail) {\r\n        vm.sharingList.shipmentSharingDefaults.shareDetailsWith.emails.splice(indexOfEmail, 1);\r\n        vm.rebuildEmails();\r\n    }\r\n\r\n    function rebuildEmails() {\r\n        vm.countEmails();\r\n        vm.blockAddButtonIfEmpty();\r\n    }\r\n\r\n    function showMoreInfo() {\r\n        showMore = true;\r\n    }\r\n\r\n    function isMoreInfoShown() {\r\n        return showMore;\r\n    }\r\n\r\n    function isActiveTab(name) {\r\n        return vm.activeEmailTemplateTab === name;\r\n    }\r\n\r\n    function setActiveTab(name) {\r\n        vm.activeEmailTemplateTab = name;\r\n    }\r\n\r\n    function revertChanges() {\r\n        vm.sharingList = angular.copy(vm.defaultSettings);\r\n    }\r\n\r\n    function cancelChangesAction() {\r\n        vm.revertChanges();\r\n        vm.rebuildEmails();\r\n    }\r\n\r\n    function saveTemplate() {\r\n        if (templateNotChanged()) {\r\n            return;\r\n        }\r\n\r\n        savedEditorHtml = $scope.ckEditorBuffer;\r\n        vm.sharingList.shipmentSharingDefaults.customTemplate.templateHtml = $scope.ckEditorHTMLToTpl(savedEditorHtml);\r\n    }\r\n\r\n    function mapOptionKey(option) {\r\n        return option && option.key || option || null;\r\n    }\r\n\r\n    function setTranslation(option) {\r\n        option.nls = `shipment-settings.nfn_shr__email_tpl_${option.name}`;\r\n        return option;\r\n    }\r\n\r\n    function templateNotChanged() {\r\n        return (!savedEditorHtml && !$scope.ckEditorBuffer) || savedEditorHtml === $scope.ckEditorBuffer;\r\n    }\r\n\r\n    function disableTemplateSaving() {\r\n        return !vm.sharingList || templateNotChanged();\r\n    }\r\n\r\n    function sendTestEmail() {\r\n        ewfCrudService.updateElement(sendTestEmailUrl, {\r\n            subject: vm.sharingList.shipmentSharingDefaults.customTemplate.emailSubject,\r\n            content: $scope.ckEditorHTMLToTpl($scope.ckEditorBuffer)\r\n        });\r\n    }\r\n}\r\n"],"sourceRoot":"/source/"}