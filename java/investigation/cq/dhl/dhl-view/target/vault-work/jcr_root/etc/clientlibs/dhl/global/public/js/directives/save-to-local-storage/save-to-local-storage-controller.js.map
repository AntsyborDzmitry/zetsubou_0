{"version":3,"sources":["directives/save-to-local-storage/save-to-local-storage-controller.js"],"names":[],"mappings":"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","file":"directives/save-to-local-storage/save-to-local-storage-controller.js","sourcesContent":["SaveToLocalStorageController.$inject = ['$window', 'logService'];\r\n\r\nexport default function SaveToLocalStorageController($window, logService) {\r\n    const formObjectCheckString = '$removeControl';\r\n    const vm = this;\r\n    const excludedForms = {};\r\n    const excludedFormFields = {\r\n        $error: 1,\r\n        $name: 1,\r\n        $dirty: 1,\r\n        $pristine: 1,\r\n        $valid: 1,\r\n        $invalid: 1,\r\n        $addControl: 1,\r\n        $removeControl: 1,\r\n        $setValidity: 1,\r\n        $setDirty: 1,\r\n        $setPristine: 1,\r\n        $modelValue: 1\r\n    };\r\n\r\n    let localStorageKey;\r\n    let localStorageFormData;\r\n\r\n    vm.populateFormFromLocalStorage = populateFormFromLocalStorage;\r\n    vm.saveDataToLocalStorage = saveDataToLocalStorage;\r\n    vm.clearStorageData = clearStorageData;\r\n    vm.addFormToExclusionList = addFormToExclusionList;\r\n    vm.isFormInExclusionList = isFormInExclusionList;\r\n    vm.addFieldToExclusionList = addFieldToExclusionList;\r\n\r\n    vm.init = init;\r\n\r\n    function init(formName) {\r\n        if (!isValidForm(formName)) {\r\n            return;\r\n        }\r\n        localStorageKey = formName;\r\n        localStorageFormData = loadDataFromLocalStorage();\r\n    }\r\n\r\n    function addFormToExclusionList(formName) {\r\n        if (!isValidForm(formName)) {\r\n            return;\r\n        }\r\n        excludedForms[formName] = 1;\r\n    }\r\n\r\n    function isFormInExclusionList(formName) {\r\n        return excludedForms.hasOwnProperty(formName);\r\n    }\r\n\r\n    function isValidForm(formName) {\r\n        if (!formName) {\r\n            logService.error('There are no \"name\" attribute on form.');\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    function getStorableKeys(objectToStore) {\r\n        return Object.keys(objectToStore).filter((key) => !excludedFormFields.hasOwnProperty(key));\r\n    }\r\n\r\n    /**\r\n     * Custom replacer for JSON.stringify method\r\n     * @param {String} key\r\n     * @param {Object} value\r\n     */\r\n    function replacer(key, value) {\r\n        let returnValue = ((key.indexOf('$') === 0) && (key !== '$viewValue') || isValueEmpty(value))\r\n            ? undefined\r\n            : value;\r\n        //do not process other forms but not skip root\r\n        if ((key !== '') && returnValue) {\r\n            returnValue = (value && value.hasOwnProperty(formObjectCheckString)) ? undefined : value;\r\n        }\r\n        return returnValue;\r\n    }\r\n\r\n    function loadDataFromLocalStorage() {\r\n        const dataAsString = $window.localStorage.getItem(localStorageKey);\r\n        return $window.JSON.parse(dataAsString);\r\n    }\r\n\r\n    //TODO: add sub forms\r\n    function saveDataToLocalStorage(formObject) {\r\n        let jsonString;\r\n        try {\r\n            jsonString = $window.JSON.stringify(formObject, replacer);\r\n        } catch (error) {\r\n            logService.error(['Error saving form \"', localStorageKey, '\" to local storage: ', error].join(''));\r\n        }\r\n        // can't use angular localStorageService because it doesn't work with custom `replacer`\r\n        $window.localStorage.setItem(localStorageKey, jsonString);\r\n    }\r\n\r\n    /**\r\n     * populate form with data restored from local storage\r\n     * @param {Object} formData data restored from local storage\r\n     */\r\n    function populateFormFromLocalStorage(formData) {\r\n        if (!localStorageFormData || !formData) {\r\n            return;\r\n        }\r\n\r\n        const storableKeys = getStorableKeys(formData);\r\n        storableKeys.forEach((key) => {\r\n            const formField = formData[key];\r\n            const storageField = localStorageFormData[key];\r\n            if (formField && storageField) {\r\n                //do not taught control if it filled from other source\r\n                if (formField.$pristine) {\r\n                    //TODO: repair combo-boxes\r\n                    formField.$setViewValue(storageField.$viewValue);\r\n                    formField.$render();\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    function addFieldToExclusionList(formFieldNamedName) {\r\n        if (formFieldNamedName) {\r\n            excludedFormFields[formFieldNamedName] = 1;\r\n        }\r\n    }\r\n\r\n    function isValueEmpty(value) {\r\n        if (!value) {\r\n            return true;\r\n        }\r\n        if (value.hasOwnProperty('length')) {\r\n            return value.length <= 0;\r\n        }\r\n        if (value.hasOwnProperty('$viewValue')) {\r\n            return !value.$viewValue;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    function clearStorageData() {\r\n        $window.localStorage.setItem(localStorageKey, null);\r\n    }\r\n}\r\n"],"sourceRoot":"/source/"}