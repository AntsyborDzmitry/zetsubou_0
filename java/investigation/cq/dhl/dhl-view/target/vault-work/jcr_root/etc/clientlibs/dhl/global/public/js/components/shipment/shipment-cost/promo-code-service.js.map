{"version":3,"sources":["components/shipment/shipment-cost/promo-code-service.js"],"names":[],"mappings":";;;qBAMwB,gBAAgB;;;;;;AAJxC,qBAAI,OAAO,CAAC,kBAAkB,EAAE,gBAAgB,CAAC,CAAC;;AAElD,oBAAgB,CAAC,OAAO,GAAG,CAAC,OAAO,EAAE,IAAI,EAAE,YAAY,CAAC,CAAC;;AAE1C,aAAS,gBAAgB,CAAC,KAAK,EAAE,EAAE,EAAE,UAAU,EAAE;AAC5D,YAAM,kBAAkB,GAAG,UAAU,CAAC;;AAEtC,iBAAS,iBAAiB,CAAC,SAAS,EAAE,SAAS,EAAE,iBAAiB,EAAE,kBAAkB,EAAE,sBAAsB,EAAE;AAC5G,gBAAM,WAAW,GAAG;AAChB,yBAAS,EAAT,SAAS;AACT,yBAAS,EAAT,SAAS;AACT,iCAAiB,EAAjB,iBAAiB;AACjB,kCAAkB,EAAlB,kBAAkB;AAClB,sCAAsB,EAAtB,sBAAsB;aACzB,CAAC;;AAEF,mBAAO,KAAK,CAAC,IAAI,CAAC,kCAAkC,EAAE,WAAW,CAAC,CAC7D,IAAI,CAAC,UAAC,QAAQ;uBAAK,QAAQ,CAAC,IAAI,CAAC,aAAa,GAAG,QAAQ,CAAC,IAAI,GAAG,EAAE,CAAC,MAAM,CAAC,QAAQ,CAAC;aAAA,CAAC,SAChF,CAAC,UAAC,QAAQ,EAAK;AACjB,0BAAU,CAAC,KAAK,CAAC,oDAAoD,EAAE,QAAQ,CAAC,IAAI,CAAC,CAAC;AACtF,uBAAO,EAAE,CAAC,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;aACnC,CAAC,CAAC;SACV;;AAED,iBAAS,kBAAkB,CAAC,UAAU,EAAE;AACpC,gBAAM,cAAc,GAAG,OAAO,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;AAChD,0BAAc,CAAC,UAAU,QAAM,kBAAkB,GAAG,UAAU,CAAC,UAAU,AAAE,CAAC;AAC5E,mBAAO,KAAK,CAAC,IAAI,CAAC,+BAA+B,EAAE,cAAc,CAAC,CAC7D,IAAI,CAAC,UAAC,QAAQ;uBAAK,QAAQ,CAAC,IAAI;aAAA,CAAC,SAC5B,CAAC,UAAC,QAAQ,EAAK;AACjB,oBAAM,MAAM,GAAG,sBAAsB,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;AACrD,0BAAU,CAAC,KAAK,CAAC,qDAAqD,EAAE,QAAQ,CAAC,CAAC;AAClF,uBAAO,EAAE,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;aAC5B,CAAC,CAAC;SACV;;AAED,iBAAS,sBAAsB,CAAC,IAAI,EAAE;AAClC,mBAAO,IAAI,CAAC,WAAW,GACnB,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,GAC7B,IAAI,CAAC,MAAM,CAAC;SACnB;;AAED,iBAAS,wBAAwB,GAAG;AAChC,mBAAO,KAAK,CAAC,GAAG,CAAC,wBAAwB,CAAC,CACrC,IAAI,CAAC,UAAC,QAAQ;uBAAK,QAAQ,CAAC,IAAI,GAAG,QAAQ,CAAC,IAAI,CAAC,iBAAiB,CAAC,MAAM,CAAC,CAAC,CAAC,GAAG,IAAI;aAAA,CAAC,SAC/E,CAAC,UAAC,QAAQ,EAAK;AACjB,0BAAU,CAAC,KAAK,0DAAwD,QAAQ,CAAC,IAAI,CAAG,CAAC;AACzF,uBAAO,EAAE,CAAC,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;aACnC,CAAC,CAAC;SACV;;AAED,iBAAS,oBAAoB,CAAC,MAAM,EAAE;AAClC,gBAAM,iBAAiB,QAAM,kBAAkB,GAAG,MAAM,AAAE,CAAC;AAC3D,mBAAO,KAAK,CAAC,IAAI,CAAC,wBAAwB,EAAE,EAAC,iBAAiB,EAAjB,iBAAiB,EAAC,CAAC,CAC3D,IAAI,CAAC,UAAC,QAAQ;uBAAK,QAAQ,CAAC,IAAI;aAAA,CAAC,SAC5B,CAAC,UAAC,QAAQ,EAAK;AACjB,0BAAU,CAAC,KAAK,4DAA0D,QAAQ,CAAC,IAAI,CAAG,CAAC;AAC3F,uBAAO,EAAE,CAAC,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;aACnC,CAAC,CAAC;SACV;;AAED,iBAAS,qBAAqB,CAAC,KAAK,EAAE;AAClC,gBAAI,oBAAoB,GAAG,CAAC,CAAC;AAC7B,iBAAK,IAAI,GAAG,GAAG,CAAC,EAAE,GAAG,GAAG,KAAK,CAAC,MAAM,EAAE,GAAG,EAAE,EAAE;AACzC,oBAAI,GAAG,GAAG,CAAC,KAAK,CAAC,EAAE;AACf,wCAAoB,IAAI,MAAM,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC;iBAC9C;aACJ;AACD,mBAAO,AAAC,oBAAoB,GAAG,CAAC,GAAG,EAAE,KAAM,CAAC,CAAC;SAChD;;AAED,eAAO;AACH,6BAAiB,EAAjB,iBAAiB;AACjB,8BAAkB,EAAlB,kBAAkB;AAClB,oCAAwB,EAAxB,wBAAwB;AACxB,gCAAoB,EAApB,oBAAoB;AACpB,8BAAkB,EAAlB,kBAAkB;AAClB,iCAAqB,EAArB,qBAAqB;SACxB,CAAC;KACL","file":"components/shipment/shipment-cost/promo-code-service.js","sourcesContent":["import ewf from 'ewf';\r\n\r\newf.service('promoCodeService', PromoCodeService);\r\n\r\nPromoCodeService.$inject = ['$http', '$q', 'logService'];\r\n\r\nexport default function PromoCodeService($http, $q, logService) {\r\n    const NECTAR_CODE_PREFIX = '98263000';\r\n\r\n    function validatePromoCode(promoCode, accountNo, paymentTypeMethod, shipperCountryCode, destinationCountryCode) {\r\n        const requestData = {\r\n            promoCode,\r\n            accountNo,\r\n            paymentTypeMethod,\r\n            shipperCountryCode,\r\n            destinationCountryCode\r\n        };\r\n\r\n        return $http.post('/api/shipment/promocode/validate', requestData)\r\n            .then((response) => response.data.accountNumber ? response.data : $q.reject(response))\r\n            .catch((response) => {\r\n                logService.error('PromoCodeService#validatePromoCode: response error', response.data);\r\n                return $q.reject(response.data);\r\n            });\r\n    }\r\n\r\n    function validateRewardCard(rewardCard) {\r\n        const rewardCardData = angular.copy(rewardCard);\r\n        rewardCardData.rewardCard = `${NECTAR_CODE_PREFIX}${rewardCard.rewardCard}`;\r\n        return $http.post('/api/shipment/reward/validate', rewardCardData)\r\n            .then((response) => response.data)\r\n            .catch((response) => {\r\n                const errors = filterRewardCardErrors(response.data);\r\n                logService.error('PromoCodeService#validateRewardCard: response error', response);\r\n                return $q.reject(errors);\r\n            });\r\n    }\r\n\r\n    function filterRewardCardErrors(data) {\r\n        return data.fieldErrors ?\r\n            Object.keys(data.fieldErrors) :\r\n            data.errors;\r\n    }\r\n\r\n    function getSavedRewardCardNumber() {\r\n        return $http.get('/api/myprofile/rewards')\r\n            .then((response) => response.data ? response.data.rewardsCardNumber.substr(8) : null)\r\n            .catch((response) => {\r\n                logService.error(`PromoCodeService#getSavedRewardCard: response error ${response.data}`);\r\n                return $q.reject(response.data);\r\n            });\r\n    }\r\n\r\n    function saveRewardCardNumber(number) {\r\n        const rewardsCardNumber = `${NECTAR_CODE_PREFIX}${number}`;\r\n        return $http.post('/api/myprofile/rewards', {rewardsCardNumber})\r\n            .then((response) => response.data)\r\n            .catch((response) => {\r\n                logService.error(`PromoCodeService#saveRewardCardNumber: response error ${response.data}`);\r\n                return $q.reject(response.data);\r\n            });\r\n    }\r\n\r\n    function validateByLuhnFormula(value) {\r\n        let sumOfEachSecondDigit = 0;\r\n        for (let pos = 0; pos < value.length; pos++) {\r\n            if (pos % 2 !== 0) {\r\n                sumOfEachSecondDigit += Number(value[pos]);\r\n            }\r\n        }\r\n        return (sumOfEachSecondDigit * 2 % 10) === 0;\r\n    }\r\n\r\n    return {\r\n        validatePromoCode,\r\n        validateRewardCard,\r\n        getSavedRewardCardNumber,\r\n        saveRewardCardNumber,\r\n        NECTAR_CODE_PREFIX,\r\n        validateByLuhnFormula\r\n    };\r\n}\r\n"],"sourceRoot":"/source/"}