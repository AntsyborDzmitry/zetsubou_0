{"version":3,"sources":["components/notification-sharing-settings/notification-sharing-directive.js"],"names":[],"mappings":"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","file":"components/notification-sharing-settings/notification-sharing-directive.js","sourcesContent":["import ewf from 'ewf';\r\nimport NotificationSharingController from './notification-sharing-controller';\r\n\r\newf.directive('notificationSharing', NotificationSharing);\r\n\r\nNotificationSharing.$inject = ['$window'];\r\n\r\nexport default function NotificationSharing($window) {\r\n    const HTMLParserFilter = $window.CKEDITOR.htmlParser.filter;\r\n    const HTMLParserText = $window.CKEDITOR.htmlParser.text;\r\n    const HTMLWriter = $window.CKEDITOR.htmlWriter;\r\n    const htmlParserFilter = new HTMLParserFilter({\r\n        elements: {\r\n            input: function(element) {\r\n                const key = element.attributes['dhl-tpl-key'];\r\n\r\n                if (key) {\r\n                    element.replaceWith(new HTMLParserText(key));\r\n                }\r\n            }\r\n        }\r\n    });\r\n    const htmlWriter = new HTMLWriter();\r\n    const nativeReplace = $window.CKEDITOR.replace;\r\n\r\n    return {\r\n        restrict: 'E',\r\n        controller: NotificationSharingController,\r\n        controllerAs: 'notificationSharingCtrl',\r\n        link: {\r\n            pre: preLink\r\n        }\r\n    };\r\n\r\n    function preLink(scope, elem, attrs, controller) {\r\n        Object.assign(scope, {\r\n            ckEditorInsertTag,\r\n            ckEditorHTMLToTpl,\r\n            ckEditorTplToHTML\r\n        });\r\n\r\n        $window.CKEDITOR.replace = function replaceWrapper(element) {\r\n            return nativeReplace.call($window.CKEDITOR, element, {\r\n                customConfig: 'ckeditor-config.js',\r\n                on: {\r\n                    instanceReady: onInstanceReady,\r\n                    dataReady: onDataReady\r\n                }\r\n            });\r\n        };\r\n\r\n        controller.init();\r\n    }\r\n\r\n    function getTagTemplate(key, name) {\r\n        return `<input dhl-tpl-key=\"${key}\" type=\"button\" value=\"[[EWF - dhl-view]]\" />`;\r\n    }\r\n\r\n    function ckEditorInsertTag(tag) {\r\n        const html = getTagTemplate(tag.key, tag.name);\r\n        const node = $window.CKEDITOR.dom.element.createFromHtml(html);\r\n\r\n        $window.CKEDITOR.instances.dhlTxtEditor.insertElement(node);\r\n    }\r\n\r\n    function elementCleanUp(context) {\r\n        context.removeAttribute('data-cke-editable');\r\n        context.removeAttribute('contenteditable');\r\n    }\r\n\r\n    function onBeforeInsertElement(eventInfo) {\r\n        eventInfo.editor.focus();\r\n    }\r\n\r\n    function onAfterInsertElement(eventInfo) {\r\n        elementCleanUp(eventInfo.data);\r\n    }\r\n\r\n    function onInstanceReady(eventInfo) {\r\n        const HIGH_PRIORITY = 9;\r\n        const LOW_PRIORITY = 11;\r\n        const editor = eventInfo.editor;\r\n\r\n        editor.on('insertElement', onBeforeInsertElement, null, null, HIGH_PRIORITY);\r\n        editor.on('insertElement', onAfterInsertElement, null, null, LOW_PRIORITY);\r\n    }\r\n\r\n    function onDataReady(eventInfo) {\r\n        const editor = eventInfo.editor;\r\n\r\n        if (editor.document) {\r\n            [...editor.document.find('[dhl-tpl-key]').$].forEach(elementCleanUp);\r\n        }\r\n    }\r\n\r\n    function ckEditorHTMLToTpl(html) {\r\n        if (!html) {\r\n            return '';\r\n        }\r\n\r\n        const fragment = $window.CKEDITOR.htmlParser.fragment.fromHtml(html);\r\n\r\n        fragment.writeHtml(htmlWriter, htmlParserFilter);\r\n\r\n        return htmlWriter.getHtml();\r\n    }\r\n\r\n    function ckEditorTplToHTML(tpl, tags) {\r\n        if (!tpl) {\r\n            return '';\r\n        }\r\n\r\n        return tpl.replace(/(\\$\\{[a-z_$][\\w$]*\\})/g, (match) => {\r\n            const tag = tags.find((item) => item.key === match);\r\n            const name = tag ? tag.name : match;\r\n\r\n            return getTagTemplate(match, name);\r\n        });\r\n    }\r\n}\r\n"],"sourceRoot":"/source/"}