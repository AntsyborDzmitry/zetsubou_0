{"version":3,"sources":["components/shipment/shipment-products/shipment-product-presenter-factory.js"],"names":[],"mappings":"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","file":"components/shipment/shipment-products/shipment-product-presenter-factory.js","sourcesContent":["import ewf from 'ewf';\r\nimport './../pickup/pickup-service';\r\nimport './../../../services/date-time-service';\r\n\r\newf.factory('shipmentProductPresenterFactory', ShipmentProductPresenterFactory);\r\n\r\nShipmentProductPresenterFactory.$inject = ['$filter', 'nlsService', 'pickupService', 'dateTimeService'];\r\n\r\nexport default function ShipmentProductPresenterFactory($filter, nlsService, pickupService, dateTimeService) {\r\n    return {\r\n        createProductPresenter\r\n    };\r\n\r\n    function createProductPresenter(data, timeZone = 'Z') {\r\n        let estimatedDelivery = preProcessDate(data.estimatedDelivery);\r\n\r\n        return new ShipmentProductPresenter();\r\n\r\n        function ShipmentProductPresenter() {\r\n            this.name = data.name;\r\n            this.code = data.code;\r\n            this.estimatedDelivery = data.estimatedDelivery;\r\n            this.deliveryDay = formatDeliveryDay();\r\n            this.deliveryDate = formatDeliveryDate();\r\n            this.deliveryMonth = formatDeliveryMonth();\r\n            this.deliveredBy = formatDeliveredBy();\r\n            this.bookBy = formatBookBy();\r\n            this.latestPickup = formatLatestPickup();\r\n            this.costTotal = formatCost(data.summary.payment.total.value);\r\n            this.costDetails = getCostDetails();\r\n            this.moneyBackGuarantee = getMoneyBackGuaranteeData();\r\n            this.receiveDeliveryNotifications = getReceiveDeliveryNotificationsData();\r\n            this.deliveryDateShort = getDeliveryDateShort();\r\n            this.volumetricWeight = getVolumetricWeight();\r\n        }\r\n\r\n        function preProcessDate(strDate) {\r\n            return strDate.replace('Z', timeZone);\r\n        }\r\n\r\n        function formatDeliveryDay() {\r\n            const day = $filter('date')(estimatedDelivery, 'EEEE').toLowerCase();\r\n            return nlsService.getTranslationSync('datetime.' + day);\r\n        }\r\n\r\n        function formatDeliveryDate() {\r\n            return $filter('date')(estimatedDelivery, 'd');\r\n        }\r\n\r\n        function formatDeliveryMonth() {\r\n            const month = $filter('date')(estimatedDelivery, 'MMMM').toLowerCase();\r\n            return nlsService.getTranslationSync('datetime.' + month);\r\n        }\r\n\r\n        function formatDeliveredBy() {\r\n            if (isEndOfDay()) {\r\n                return nlsService.getTranslationSync('shipment.shipment_products_delivery_by_end_of_day');\r\n            }\r\n\r\n            const timeMask = nlsService.getTranslationSync(\r\n                    'shipment.shipment_products_delivery_by_time_mask'\r\n                ) || 'shortTime';\r\n            return $filter('date')(estimatedDelivery, timeMask).toLowerCase();\r\n        }\r\n\r\n        function isEndOfDay() {\r\n            const time = $filter('date')(estimatedDelivery, 'shortTime');\r\n            return (time === '11:59 PM');\r\n        }\r\n\r\n        function formatBookBy() {\r\n            const latestBooking = pickupService.getLatestBooking(data);\r\n            return dateTimeService.getFormattedTime(latestBooking, true);\r\n        }\r\n\r\n        function formatLatestPickup() {\r\n            return dateTimeService.getFormattedTime(data.pickupEndTime, true);\r\n        }\r\n\r\n        function formatCost(value) {\r\n            return $filter('number')(value, 2);\r\n        }\r\n\r\n        function getCostDetails() {\r\n            const details = data.summary.payment.details.map((detail) => {\r\n                const nlsKey = `shipment.details_${transformStringToNlsKey(detail.name)}`;\r\n                let name = nlsService.getTranslationSync(nlsKey).replace('{label}', detail.label || '');\r\n                if (name === nlsKey) {\r\n                    name = toTitleCase(detail.name);\r\n                }\r\n                const value = calculateCostDetailsValue(detail);\r\n\r\n                return {name, value};\r\n            });\r\n\r\n            return details.sort((first, second) => second.value - first.value);\r\n        }\r\n\r\n        function transformStringToNlsKey(name) {\r\n            return name.toLowerCase().replace(/[\\s\\/:]/g, '_').replace(/&/g, 'and');\r\n        }\r\n\r\n        function calculateCostDetailsValue(detail) {\r\n            const val = detail.taxes\r\n                ? detail.taxes.reduce((sum, tax) => sum + tax.baseValue, 0)\r\n                : detail.price.value;\r\n            return formatCost(val);\r\n        }\r\n\r\n        function getMoneyBackGuaranteeData() {\r\n            let applicable = !!data.summary.moneyBackGuarantee;\r\n            let text = nlsService.getTranslationSync('shipment.shipment_products_details_money_back_guarantee');\r\n            let tooltip = nlsService.getTranslationSync(\r\n                'shipment.shipment_products_details_money_back_guarantee_tooltip'\r\n            );\r\n            tooltip = tooltip.replace('{product_name}', data.name);\r\n            return {\r\n                applicable,\r\n                text,\r\n                tooltip\r\n            };\r\n        }\r\n\r\n        function getReceiveDeliveryNotificationsData() {\r\n            let applicable = !!data.summary.receiveDeliveryNotifications;\r\n            let text = nlsService.getTranslationSync(\r\n                'shipment.shipment_products_details_receive_delivery_notifications'\r\n            );\r\n            let tooltip = nlsService.getTranslationSync(\r\n                'shipment.shipment_products_details_receive_delivery_notifications_tooltip'\r\n            );\r\n            return {\r\n                applicable,\r\n                text,\r\n                tooltip\r\n            };\r\n        }\r\n\r\n        function getDeliveryDateShort() {\r\n            let dateShortString = '';\r\n            if (estimatedDelivery) {\r\n                const deliveryDay = $filter('date')(estimatedDelivery, 'EEEE').toLowerCase();\r\n                const deliveryMonth = $filter('date')(estimatedDelivery, 'MMMM').toLowerCase();\r\n                const dayWeek = nlsService.getTranslationSync('datetime.' + deliveryDay + '_short');\r\n                const dayNumber = formatDeliveryDate();\r\n                const month = nlsService.getTranslationSync('datetime.' + deliveryMonth + '_short');\r\n                const year = $filter('date')(estimatedDelivery, 'yyyy');\r\n                dateShortString = `${dayWeek}, ${dayNumber} ${month}, ${year}`;\r\n            }\r\n            return dateShortString;\r\n        }\r\n\r\n        function getVolumetricWeight() {\r\n            if (data.volumetricWeight) {\r\n                const volumetricUnit = data.volumetricUnit.toLowerCase();\r\n                return `${data.volumetricWeight} ${volumetricUnit}`;\r\n            }\r\n        }\r\n\r\n        function toTitleCase(key) {\r\n            return key.toLowerCase().replace(/\\b\\w/g, (letter) => letter.toUpperCase());\r\n        }\r\n    }\r\n}\r\n"],"sourceRoot":"/source/"}