{"version":3,"sources":["components/shipment/shipment-type/item-attributes/item-attributes-model.js"],"names":[],"mappings":"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","file":"components/shipment/shipment-type/item-attributes/item-attributes-model.js","sourcesContent":["import './../../ewf-shipment-service';\r\nimport ewf from 'ewf';\r\n\r\newf.service('itemAttributesModel', ItemAttributesModel);\r\n\r\nItemAttributesModel.$inject = ['$filter', 'shipmentService'];\r\n\r\nexport default function ItemAttributesModel($filter, shipmentService) {\r\n    Object.assign(this, {\r\n        productList: [],\r\n        invoiceDescription: '',\r\n        totalQuantity: 1,\r\n        totalNetWeight: 0,\r\n        totalGrossWeight: 0,\r\n        totalDeclareValue: '',\r\n        currenciesList: [],\r\n        currentCurrency: {type: 'USD'},\r\n\r\n        init,\r\n        addItemAttributesRow,\r\n        copyItemAttributesRow,\r\n        deleteItemAttributesRow,\r\n        isDutiesCountable,\r\n        calculateTotalQuantity,\r\n        calculateTotalWeight,\r\n        calculateTotalShipmentValue,\r\n        calculateTotalTax\r\n    });\r\n\r\n    function init() {\r\n        this.currenciesList = shipmentService.getCurrencies();\r\n        this.currentCurrency = this.currenciesList.find((currency) => currency.default) || {type: 'USD'};\r\n\r\n        if (!this.productList.length) {\r\n            this.productList = [generateItemAttributesRow(this.currentCurrency.type)];\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    function addItemAttributesRow() {\r\n        this.productList.push(generateItemAttributesRow(this.currentCurrency.type));\r\n    }\r\n\r\n    function copyItemAttributesRow(row) {\r\n        const copiedRow = angular.copy(row);\r\n        this.productList.splice(this.productList.indexOf(row) + 1, 0, copiedRow);\r\n    }\r\n\r\n    function deleteItemAttributesRow(row) {\r\n        const position = this.productList.indexOf(row);\r\n        this.productList.splice(position, 1);\r\n    }\r\n\r\n    function generateItemAttributesRow(currency) {\r\n        return {\r\n            id: '',\r\n            name: '',\r\n            description: '',\r\n            quantity: 1,\r\n            quantityUnits: '',\r\n            value: '',\r\n            currency,\r\n            netWeight: '',\r\n            grossWeight: '',\r\n            commodityCode: '',\r\n            countryOfManufactureCode: '',\r\n            groupId: undefined,\r\n            isProductListVisible: false\r\n        };\r\n    }\r\n\r\n    function isDutiesCountable(row) {\r\n        const list = row ? [row] : this.productList;\r\n        return !!list.length && list.some((item) => item.commodityCode && item.value);\r\n    }\r\n\r\n    function calculateTotalQuantity() {\r\n        const sum = $filter('calculateTotal')(this.productList, 'quantity');\r\n        this.totalQuantity = sum;\r\n        return sum;\r\n    }\r\n\r\n    function calculateTotalWeight(field, fieldToSet) {\r\n        const sum = $filter('calculateTotal')(this.productList, field, 'quantity');\r\n        if (fieldToSet) {\r\n            this[fieldToSet] = sum;\r\n        }\r\n        return sum;\r\n    }\r\n\r\n    function calculateTotalShipmentValue() {\r\n        const sum = $filter('calculateTotal')(this.productList, 'value', 'quantity');\r\n        const priceString = $filter('currency')(sum, this.currentCurrency.symbol, this.currentCurrency.fractionSize);\r\n\r\n        return `${priceString} ${this.currentCurrency.type}`;\r\n    }\r\n\r\n    function calculateTotalTax(taxType) {\r\n        const taxes = angular.isArray(taxType) ? taxType : [taxType];\r\n        const list = this.productList;\r\n\r\n        const total = list.reduce((currentTotal, item) => {\r\n            if (!this.isDutiesCountable(item)) {\r\n                return currentTotal;\r\n            }\r\n\r\n            const totalTaxes = taxes.reduce((currentTaxesTotal, tax) => currentTaxesTotal + item[tax], 0);\r\n            const currentValue = item.value * totalTaxes / 100 * item.quantity;\r\n            return currentTotal + (currentValue || 0);\r\n        }, 0);\r\n\r\n        return $filter('currency')(+total.toFixed(2), this.currentCurrency.symbol, this.currentCurrency.fractionSize);\r\n    }\r\n}\r\n"],"sourceRoot":"/source/"}