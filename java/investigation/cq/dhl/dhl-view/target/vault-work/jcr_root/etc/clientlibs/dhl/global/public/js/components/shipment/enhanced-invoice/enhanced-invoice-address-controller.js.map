{"version":3,"sources":["components/shipment/enhanced-invoice/enhanced-invoice-address-controller.js"],"names":[],"mappings":"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","file":"components/shipment/enhanced-invoice/enhanced-invoice-address-controller.js","sourcesContent":["import './../../../services/modal/modal-service';\r\nimport './enhanced-invoice-model';\r\nimport './../ewf-shipment-service';\r\nimport '../../../services/ewf-crud-service';\r\n\r\nEnhancedInvoiceAddressController.$inject = ['$scope',\r\n                                            '$timeout',\r\n                                            'modalService',\r\n                                            'enhancedInvoiceModel',\r\n                                            'ewfCrudService'];\r\n\r\nexport default function EnhancedInvoiceAddressController($scope,\r\n                                                         $timeout,\r\n                                                         modalService,\r\n                                                         enhancedInvoiceModel,\r\n                                                         ewfCrudService) {\r\n    const vm = this;\r\n\r\n    const ACTION = {\r\n        ADD: 'add',\r\n        MODIFY: 'modify'\r\n    };\r\n\r\n    /**\r\n    * At the moment it is not possible to save/update Contact\r\n    * without sending \"notifications\" object.\r\n    * But there is no possibility for User to setup notifications\r\n    * from Enhanced Customs Invoice (and Address Details as well).\r\n    *\r\n    * TODO: Make it optional on BE side.\r\n    * Jira task created to be implemented next Sprint: DHLEWFCON-10890.\r\n    */\r\n    const notifications = {\r\n        emailNotifications: [{\r\n            notificationEvents: {\r\n                clearedCustoms: false,\r\n                deliveryDelay: false,\r\n                pickedUpByCourier: false,\r\n                customsDelay: false,\r\n                delivered: false\r\n            },\r\n            destination: 'userSuccess@test.com',\r\n            email: 'userSuccess@test.com',\r\n            language: 'en',\r\n            phoneCountryCode: '',\r\n            type: 'EMAIL'\r\n        }],\r\n        smsNotifications: []\r\n    };\r\n\r\n    let modalWindow;\r\n    let clear = true;\r\n\r\n\r\n    Object.assign(vm, {\r\n        showButtons: false,\r\n\r\n        init,\r\n        addressBookSelected,\r\n        showSaveContactDialog,\r\n        updateContact,\r\n        clearAddress,\r\n        anyActionConfirmed\r\n    });\r\n\r\n\r\n    function init() {\r\n        vm.invoice = enhancedInvoiceModel;\r\n        $scope.saveContact = saveContact;\r\n        $scope.$watch(() => vm.invoice.contactDetails, () => {\r\n            vm.saveConfirmed = false;\r\n            vm.updateConfirmed = false;\r\n            if (clear) {\r\n                vm.showButtons = false;\r\n                $timeout(() => clear = false);\r\n                return;\r\n            }\r\n            vm.showButtons = true;\r\n        }, true);\r\n    }\r\n\r\n    function addressBookSelected(contact) {\r\n        enhancedInvoiceModel.setContactDetails(contact);\r\n    }\r\n\r\n    function showSaveContactDialog() {\r\n        modalWindow = modalService.showDialog({\r\n            closeOnEsc: true,\r\n            scope: $scope,\r\n            windowClass: 'ngdialog-theme-default',\r\n            template:'<div ewf-modal><div class=\\\"row fw-bold\\\" nls=shipment.address_details_save_nickname></div><input type=text class=\\\"input input_width_full\\\" ng-model=nickname><div class=ewf-modal__footer><button type=button class=btn ng-click=\\\"saveContact(nickname, newContact, identifier)\\\" nls=shipment.address_details_save></button></div></div>'\r\n        });\r\n    }\r\n\r\n    function saveContact(nickName) {\r\n        vm.nickName = nickName;\r\n        const contact = composeContact();\r\n        sendContact(ACTION.ADD, contact);\r\n\r\n    }\r\n\r\n    function updateContact() {\r\n        vm.nickName = vm.invoice.contactDetails.nickName;\r\n\r\n        const contact = composeContact();\r\n        contact.key = vm.invoice.contactDetails.addressDetails.key;\r\n\r\n        sendContact(ACTION.MODIFY, contact);\r\n    }\r\n\r\n    function sendContact(action, contact) {\r\n        ewfCrudService.addElement(`/api/addressbook/contact/${action}`, contact)\r\n            .then(() => {\r\n                if (action === ACTION.ADD) {\r\n                    vm.saveConfirmed = true;\r\n                } else {\r\n                    vm.updateConfirmed = true;\r\n                }\r\n            })\r\n            .finally(() => {\r\n                modalWindow.close();\r\n            });\r\n    }\r\n\r\n    function composeContact() {\r\n        return {\r\n            contactDetails: {\r\n                name: vm.invoice.contactDetails.name,\r\n                company: vm.invoice.contactDetails.company,\r\n                email: vm.invoice.contactDetails.email,\r\n                addressDetails: vm.invoice.contactDetails.addressDetails,\r\n                phoneDetails: vm.invoice.contactDetails.phone.phoneDetails,\r\n                nickname: vm.nickName\r\n            },\r\n            notifications\r\n        };\r\n    }\r\n\r\n    function clearAddress() {\r\n        clear = true;\r\n        enhancedInvoiceModel.clearAddress();\r\n    }\r\n\r\n    function anyActionConfirmed() {\r\n        return vm.updateConfirmed || vm.saveConfirmed;\r\n    }\r\n}\r\n"],"sourceRoot":"/source/"}