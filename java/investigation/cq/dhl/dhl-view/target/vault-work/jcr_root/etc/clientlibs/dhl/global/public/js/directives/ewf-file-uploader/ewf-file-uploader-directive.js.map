{"version":3,"sources":["directives/ewf-file-uploader/ewf-file-uploader-directive.js"],"names":[],"mappings":"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","file":"directives/ewf-file-uploader/ewf-file-uploader-directive.js","sourcesContent":["import ewf from 'ewf';\r\nimport EwfFileUploaderController from './ewf-file-uploader-controller';\r\nimport angular from 'angular';\r\n\r\newf.directive('ewfFileUploader', EwfFileUploader);\r\n\r\nEwfFileUploader.$inject = ['$window', 'attrsService'];\r\n\r\nexport default function EwfFileUploader($window, attrsService) {\r\n    return {\r\n        restrict: 'EA',\r\n        controller: EwfFileUploaderController,\r\n        controllerAs: 'fileUploaderCtrl',\r\n        scope: true,\r\n        link: {\r\n            post: postLink\r\n        }\r\n    };\r\n\r\n    function postLink(scope, element, attributes, fileUploaderCtrl) {\r\n        const selectFileInput = element.find('input');\r\n\r\n        attributes.$observe('action', () => {\r\n            fileUploaderCtrl.onFormReady(getPreparedSubmitElements(element));\r\n        });\r\n\r\n        selectFileInput.on('click', (event) => {\r\n            const fileInput = event.target;\r\n            if (fileInput.type === 'file') {\r\n                fileInput.value = '';\r\n                attrsService.trigger(scope, attributes, 'filesBeforeSelect');\r\n            }\r\n        });\r\n\r\n        selectFileInput.on('change', (event) => {\r\n            const fileInput = event.target;\r\n            if (fileInput.type === 'file') {\r\n                scope.$apply(() => {\r\n                    fileUploaderCtrl.onFilesReadyToUpload(fileInput.files || fileInput.value);\r\n                });\r\n            }\r\n        });\r\n    }\r\n\r\n    function getPreparedSubmitElements(element) {\r\n        const form = element.parents('form')[0];\r\n        const frame = createFrame();\r\n        const formAction = form.getAttribute('action');\r\n        const url = /(^.*\\??)/.exec(formAction)[0];\r\n        const urlParameters = /(\\?.*$)/.exec(formAction);\r\n        form.setAttribute('target', frame.id);\r\n        return {\r\n            form,\r\n            frame,\r\n            url,\r\n            urlParameters: urlParameters ? urlParameters[0] : ''\r\n        };\r\n    }\r\n\r\n    function createFrame() {\r\n        const frameName = Math.floor(Math.random() * 99999);\r\n        const documentObject = $window.document;\r\n        const frame = angular.element('<iframe></iframe>')[0];\r\n        const frameNamePrefix = 'file_uploader_frame_';\r\n\r\n        frame.setAttribute('id', `${frameNamePrefix}${frameName}`);\r\n        frame.setAttribute('name', `${frameNamePrefix}${frameName}`);\r\n        frame.style.display = 'none';\r\n        documentObject.body.appendChild(frame);\r\n        return frame;\r\n    }\r\n}\r\n"],"sourceRoot":"/source/"}