{"version":3,"sources":["components/shipment/shipment-type/item-attributes/item-attributes-form-controller.js"],"names":[],"mappings":"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","file":"components/shipment/shipment-type/item-attributes/item-attributes-form-controller.js","sourcesContent":["import './../../../../services/location-service';\r\nimport './item-attributes-model';\r\nimport './item-attributes-service';\r\nimport './../../ewf-shipment-service';\r\nimport './../shipment-type-service';\r\nimport './../../../../services/modal/modal-service';\r\n\r\nItemAttributesFormController.$inject = ['$scope',\r\n                                        'modalService',\r\n                                        'locationService',\r\n                                        'itemAttributesModel',\r\n                                        'itemAttributesService',\r\n                                        'shipmentService',\r\n                                        'shipmentTypeService'];\r\n\r\nexport default function ItemAttributesFormController($scope,\r\n                                                     modalService,\r\n                                                     locationService,\r\n                                                     itemAttributesModel,\r\n                                                     itemAttributesService,\r\n                                                     shipmentService,\r\n                                                     shipmentTypeService) {\r\n    const vm = this;\r\n\r\n    Object.assign(vm, {\r\n        init,\r\n        isSaveable,\r\n        handleSaveItemAttributesAction,\r\n        setSavingRowData,\r\n        saveItemAttributesRow,\r\n        weightUnits,\r\n        isProductWeightValid,\r\n        showProductList,\r\n        hideProductList,\r\n        pickProductListGroup,\r\n        isCommodityCodesVisible,\r\n        showCommoditiesCodeSearchPopup,\r\n        pickCommodityCode,\r\n        getCommodityCodeSubcategories,\r\n        getCommodityCodes,\r\n        showProductCatalogPopup,\r\n        hideProductCatalogPopup,\r\n        pickProductCatalogRow,\r\n        updateProductCatalog,\r\n        updateTaxesFromCommodityCode,\r\n        toggleShowCountriesList,\r\n        pickCountry,\r\n        onNextClick,\r\n\r\n        PROHIBITED_ITEM: 'prohibited item',\r\n        itemAttributesModel: {},\r\n        quantityUnits: [],\r\n\r\n        countriesList: [],\r\n        isUnitsMismatched: false,\r\n        shipperCountrySom: '',\r\n        userProfileCountrySom: '',\r\n        weightConvertionRate: 1,\r\n        dimensionConvertionRate: 1,\r\n        shipperCountryConversionPrecision: 2,\r\n        userProfileCountryConversionPrecision: 2,\r\n        defaultQuantityUnit: '',\r\n        productList: [],\r\n        productListFiltered: [],\r\n        productGroups: [],\r\n        isProductCatalogVisible: false,\r\n        productCatalogColumns: [\r\n            {alias: 'name', title: 'shipment.shipment_type_packages_product_catalog_name_title'},\r\n            {alias: 'description', title: 'shipment.shipment_type_packages_product_catalog_description_title'},\r\n            {alias: 'commodityCode', title: 'shipment.shipment_type_packages_product_catalog_commodity_code_title'},\r\n            {alias: 'countryCode', title: 'shipment.shipment_type_packages_product_catalog_country_title'}\r\n        ],\r\n        commodityCodesCategories: [],\r\n        commodityCodesCurrentCategory: {},\r\n        commodityCodesCurrentSubCategory: {},\r\n\r\n        PATTERNS: {\r\n            quantity: '(^[1-9][0-9]*$)|(?:^$)',\r\n            commodityCode: '^\\\\d(?:[\\\\-\\\\.]?\\\\d{1,6})?$',\r\n            dimension: '^(([1-9]+\\\\d*)|(\\\\d+\\\\.\\\\d+))$|^$'\r\n        }\r\n    });\r\n\r\n    const CUSTOMS_INVOICE_TYPE = {\r\n        CREATE: 'CREATE',\r\n        USE: 'USE'\r\n    };\r\n    const WEIGHT_UOM = {\r\n        METRIC: 'kg',\r\n        IMPERIAL: 'lb'\r\n    };\r\n\r\n    let itemAttributesSavePopup, commodityCodeSearchPopup;\r\n\r\n    function init() {\r\n        mapSomParameters();\r\n\r\n        vm.itemAttributesModel = itemAttributesModel.init();\r\n\r\n        itemAttributesService.getShipmentItemAttributesDetails()\r\n            .then(onGetShipmentItemAttributesDetails);\r\n\r\n        const fromCountry = shipmentService.getShipmentCountry();\r\n        const toCountry = shipmentService.getDestinationCountry();\r\n        shipmentTypeService.getShipmentParameters(fromCountry, toCountry)\r\n            .then(onGetShipmentParameters);\r\n\r\n        itemAttributesService.getCommodityCodeCategories()\r\n            .then(onGetCommodityCodeCategories);\r\n\r\n        locationService.loadAvailableLocations()\r\n            .then((countriesList) => vm.countriesList = countriesList);\r\n    }\r\n\r\n    function mapSomParameters() {\r\n        Object.assign(vm, shipmentService.getCountrySomParameters());\r\n        vm.isUnitsMismatched = vm.shipperCountrySom !== vm.userProfileCountrySom;\r\n    }\r\n\r\n    function onGetShipmentItemAttributesDetails(response) {\r\n        vm.productList = vm.productListFiltered = response.productList;\r\n        vm.productGroups = response.productGroups;\r\n    }\r\n\r\n    function onGetShipmentParameters(response) {\r\n        vm.quantityUnits = response.units.map((unit) => unit.name);\r\n        vm.defaultQuantityUnit = response.units.find((unit) => unit.default).name;\r\n\r\n        vm.itemAttributesModel.productList\r\n            .filter((product) => !product.quantityUnits)\r\n            .forEach((product) => {\r\n                product.quantityUnits = vm.defaultQuantityUnit;\r\n            });\r\n    }\r\n\r\n    function onGetCommodityCodeCategories(response) {\r\n        vm.commodityCodesCategories = response;\r\n        vm.commodityCodesCurrentCategory = {};\r\n    }\r\n\r\n    function isSaveable(row) {\r\n        return !!(!row.id && row.description && row.commodityCode && row.countryOfManufactureCode && !row.isActive);\r\n    }\r\n\r\n    function handleSaveItemAttributesAction(row) {\r\n        row.isActive = true;\r\n\r\n        row.name = '';\r\n        row.groupId = '';\r\n\r\n        itemAttributesSavePopup = modalService\r\n            .showDialog({\r\n                closeOnEsc: true,\r\n                scope: $scope,\r\n                windowClass: 'ngdialog-theme-default ngdialog-theme-small',\r\n                template:'<div ewf-modal nls-title=shipment.shipment_type_packages_customs_invoice_save_popup_title><div class=form-row><label class=block nls=shipment.shipment_type_packages_customs_invoice_save_product_name></label> <input type=text class=\\\"input input_width_full\\\" ng-model=name ng-change=itemAttrFormCtrl.setSavingRowData(name)></div><div class=form-row><label class=block nls=shipment.shipment_type_packages_customs_invoice_save_product_group></label> <span class=\\\"select full-width\\\"><select ng-model=option ng-options=\\\"group.id as group.name for group in itemAttrFormCtrl.productGroups\\\" ng-change=\\\"itemAttrFormCtrl.setSavingRowData(\\'\\', option)\\\"></select></span></div><div class=\\\"row right margin-top\\\"><button type=button class=btn nls=shipment.shipment_type_packages_customs_invoice_save_product_button ng-disabled=!itemAttrFormCtrl.productGroups.length ng-click=itemAttrFormCtrl.saveItemAttributesRow()></button></div></div>'\r\n            });\r\n        itemAttributesSavePopup.result\r\n            .finally(() => {\r\n                row.isActive = false;\r\n            });\r\n    }\r\n\r\n    function setSavingRowData(name, groupId) {\r\n        const rowSaving = vm.itemAttributesModel.productList.find((row) => row.isActive);\r\n        rowSaving.name = name || rowSaving.name;\r\n        rowSaving.groupId = groupId || rowSaving.groupId;\r\n    }\r\n\r\n    function saveItemAttributesRow() {\r\n        const rowSaving = vm.itemAttributesModel.productList.find((row) => row.isActive);\r\n        rowSaving.countryCode = rowSaving.countryOfManufactureCode;\r\n\r\n        itemAttributesService.saveShipmentItemAttributes(rowSaving)\r\n            .then((response) => {\r\n                rowSaving.id = response.id;\r\n                if (!vm.productList.find((group) => group.id === rowSaving.id)) {\r\n                    vm.productList.push(angular.copy(rowSaving));\r\n                }\r\n            })\r\n            .finally(() => rowSaving.isActive = false);\r\n\r\n        itemAttributesSavePopup.close();\r\n    }\r\n\r\n    function weightUnits(toggle) {\r\n        let uom = vm.shipperCountrySom;\r\n        if (toggle) {\r\n            uom = uom === 'METRIC' ? 'IMPERIAL' : 'METRIC';\r\n        }\r\n        return WEIGHT_UOM[uom];\r\n    }\r\n\r\n    function isProductWeightValid(product) {\r\n        const grossWeight = +product.grossWeight || 0;\r\n        const netWeight = +product.netWeight || 0;\r\n        return grossWeight >= netWeight;\r\n    }\r\n\r\n    function showProductList(row) {\r\n        row.isProductListVisible = vm.productList.some((group) =>\r\n            group.description.toLowerCase().includes(row.description.toLowerCase()));\r\n    }\r\n\r\n    function hideProductList(row) {\r\n        row.isProductListVisible = false;\r\n    }\r\n\r\n    function pickProductListGroup(row, group) {\r\n        row.name = group.name;\r\n        row.description = group.description;\r\n        row.commodityCode = group.commodityCode;\r\n        row.groupId = group.groupId;\r\n        row.countryOfManufactureCode = group.countryCode;\r\n\r\n        hideProductList(row);\r\n    }\r\n\r\n    function isCommodityCodesVisible() {\r\n        return !!((vm.commodityCodeSearchQuery || vm.commodityCodesCurrentCategory.id) && vm.commodityCodesList.length);\r\n    }\r\n\r\n    function showCommoditiesCodeSearchPopup(product) {\r\n        product.isActive = true;\r\n\r\n       commodityCodeSearchPopup = modalService\r\n            .showDialog({\r\n                closeOnEsc: true,\r\n                scope: $scope,\r\n                windowClass: 'ngdialog-theme-default ngdialog-theme-middle',\r\n                template:'<div ewf-modal nls-title=shipment.shipment_type_packages_customs_invoice_commodity_popup_title><div class=form-row><label nls=shipment.shipment_type_packages_item_attributes_description></label> <input type=text class=\\\"input input_width_full\\\" ng-model=itemAttrFormCtrl.commodityCodeSearchQuery ng-change=itemAttrFormCtrl.getCommodityCodes()></div><div class=form-row><label nls=shipment.shipment_type_packages_customs_invoice_commodity_category_label></label> <span class=\\\"select full-width\\\"><select name=commodityCodeCategory ng-options=\\\"category.name for category in itemAttrFormCtrl.commodityCodesCategories track by category.id\\\" ng-change=itemAttrFormCtrl.getCommodityCodeSubcategories() ng-model=itemAttrFormCtrl.commodityCodesCurrentCategory></select></span></div><div class=form-row ng-if=itemAttrFormCtrl.commodityCodesCurrentCategory.id><label nls=shipment.shipment_type_packages_customs_invoice_commodity_subcategory_label></label> <span class=\\\"select full-width\\\"><select name=commodityCodeSubcategory ng-options=\\\"subcategory.name for subcategory in itemAttrFormCtrl.commodityCodesCurrentCategory.subcategories track by subcategory.id\\\" ng-change=itemAttrFormCtrl.getCommodityCodes() ng-model=itemAttrFormCtrl.commodityCodesCurrentSubCategory></select></span></div><div class=form-row ng-if=itemAttrFormCtrl.isCommodityCodesVisible()><table class=\\\"table table_zebra table_hover\\\"><thead><tr><th nls=shipment.shipment_type_packages_customs_invoice_commodity_table_code_label></th><th nls=shipment.shipment_type_packages_customs_invoice_commodity_table_description_label></th><th nls=shipment.shipment_type_packages_customs_invoice_commodity_table_tariff_label></th><th nls=shipment.shipment_type_packages_customs_invoice_commodity_table_tax_label></th></tr></thead><tbody><tr ng-repeat=\\\"commodity in itemAttrFormCtrl.commodityCodesList\\\" ng-click=itemAttrFormCtrl.pickCommodityCode(commodity)><td>{{commodity.id}}</td><td><p class=margin-none>{{commodity.name}}</p><small>{{commodity.description}}</small></td><td>{{commodity.tariff | number : 1}}%</td><td>{{commodity.tax | number : 1}}%</td></tr></tbody></table></div></div>'\r\n            });\r\n        commodityCodeSearchPopup.result\r\n            .finally(() => {\r\n                product.isActive = false;\r\n            });\r\n    }\r\n\r\n    function pickCommodityCode(commodity) {\r\n        const row = vm.itemAttributesModel.productList.find((product) => product.isActive);\r\n        row.isActive = false;\r\n        row.commodityCode = commodity.id;\r\n        row.dutyPercent = commodity.tariff;\r\n        row.taxPercent = commodity.tax;\r\n\r\n        commodityCodeSearchPopup.close();\r\n    }\r\n\r\n    function getCommodityCodeSubcategories() {\r\n        vm.getCommodityCodes();\r\n        vm.commodityCodesCurrentCategory.subcategories = [];\r\n\r\n        const id = vm.commodityCodesCurrentCategory.id;\r\n        itemAttributesService.getCommodityCodeSubcategories(id)\r\n            .then((subcategoriesList) => {\r\n                vm.commodityCodesCurrentSubCategory = {};\r\n                vm.commodityCodesCurrentCategory.subcategories = subcategoriesList;\r\n            });\r\n    }\r\n\r\n    function getCommodityCodes() {\r\n        vm.commodityCodesList = [];\r\n\r\n        const query = vm.commodityCodeSearchQuery || '';\r\n        const categoryId = vm.commodityCodesCurrentCategory.id || '';\r\n        const subcategoryId = categoryId ? (vm.commodityCodesCurrentSubCategory.id || '') : '';\r\n        itemAttributesService.getCommodityCodes(query, categoryId, subcategoryId)\r\n            .then((commodityCodesList) => {\r\n                vm.commodityCodesList = commodityCodesList;\r\n            });\r\n    }\r\n\r\n    function showProductCatalogPopup(product) {\r\n        product.isActive = true;\r\n        vm.isProductCatalogVisible = true;\r\n    }\r\n\r\n    function hideProductCatalogPopup() {\r\n        vm.isProductCatalogVisible = false;\r\n        vm.itemAttributesModel.productList.forEach((row) => {\r\n            row.isActive = false;\r\n        });\r\n    }\r\n\r\n    function pickProductCatalogRow(row) {\r\n        const activeProduct = vm.itemAttributesModel.productList.find((product) => product.isActive);\r\n        vm.pickProductListGroup(activeProduct, row);\r\n        hideProductCatalogPopup();\r\n    }\r\n\r\n    function updateProductCatalog() {\r\n        const query = (vm.productCatalogSearchQuery || '').toLowerCase();\r\n        vm.productListFiltered = vm.productList.filter((product) => product.description.toLowerCase().includes(query));\r\n        vm.gridCtrl.rebuildGrid(vm.productListFiltered);\r\n    }\r\n\r\n    function joinArrays(arrayOfArrays) {\r\n        return arrayOfArrays.length ? Array.concat(...arrayOfArrays) : [];\r\n    }\r\n\r\n    function updateTaxesFromCommodityCode(row) {\r\n        const categories = vm.commodityCodesCategories.filter((el) => el !== undefined && el.subcategories);\r\n        const subCategories = joinArrays(categories.map((category) => category.subcategories));\r\n        const commodityCodes = joinArrays(subCategories.map((category) => category.commodityCodes));\r\n\r\n        const commodity = commodityCodes.find((code) => code.id === row.commodityCode);\r\n        row.dutyPercent = commodity ? commodity.tariff : 0;\r\n        row.taxPercent = commodity ? commodity.tax : 0;\r\n    }\r\n\r\n    function toggleShowCountriesList(product, state) {\r\n        product.isCountriesListVisible = state;\r\n    }\r\n\r\n    function pickCountry(product, country) {\r\n        product.countryOfManufactureCode = country.code2;\r\n        product.countryName = country.name;\r\n\r\n        vm.toggleShowCountriesList(product, false);\r\n    }\r\n\r\n    function onNextClick() {\r\n        const customsInvoiceType = shipmentService.getCustomsInvoiceType();\r\n        if (customsInvoiceType === CUSTOMS_INVOICE_TYPE.CREATE) {\r\n            shipmentService.setCustomsInvoice(vm.itemAttributesModel);\r\n        } else {\r\n            shipmentService.setCustomsInvoice();\r\n        }\r\n    }\r\n}\r\n"],"sourceRoot":"/source/"}