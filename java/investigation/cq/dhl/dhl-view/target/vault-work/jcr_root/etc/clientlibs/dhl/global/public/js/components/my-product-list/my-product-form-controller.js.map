{"version":3,"sources":["components/my-product-list/my-product-form-controller.js"],"names":[],"mappings":"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","file":"components/my-product-list/my-product-form-controller.js","sourcesContent":["import './../../services/ewf-crud-service';\r\nimport './../../services/attrs-service';\r\nimport './../profile-shipment-defaults/services/profile-shipment-service';\r\n\r\nMyProductFormController.$inject = [\r\n    '$scope',\r\n    '$attrs',\r\n    '$timeout',\r\n    'locationService',\r\n    'ewfCrudService',\r\n    'attrsService',\r\n    'profileShipmentService'\r\n];\r\n\r\nexport default function MyProductFormController(\r\n    $scope,\r\n    $attrs,\r\n    $timeout,\r\n    locationService,\r\n    ewfCrudService,\r\n    attrsService,\r\n    profileShipmentService\r\n) {\r\n\r\n    const vm = this;\r\n    const productUrl = '/api/myprofile/customs/products';\r\n\r\n    const productDefaults = {\r\n        weightUnits: 'KG',\r\n        currency: 'USD',\r\n        importProduct: false\r\n    };\r\n\r\n    const emptyImportCommodityCode = {\r\n        key: 0,\r\n        commodityCode: '',\r\n        countryCode: ''\r\n    };\r\n\r\n    Object.assign(vm, {\r\n        isEditMode: false,\r\n        hasUnitsList: false,\r\n        currencyList: [],\r\n        availableLocations: [],\r\n        product: {},\r\n\r\n        init,\r\n        addProduct,\r\n        updateProduct,\r\n        cancelForm,\r\n        canAddCommodityCode,\r\n        canShowRemoveButton,\r\n        addNewCommodityCode,\r\n        removeCommodityCode,\r\n        clearCountryCode,\r\n        countryTypeaheadOnSelect,\r\n        productCountryTypeaheadOnSelect\r\n    });\r\n\r\n    function init() {\r\n        resetProductDefaults();\r\n        getUomAndCurrency();\r\n        locationService.loadAvailableLocations()\r\n            .then((locations) => {\r\n                vm.availableLocations = locations;\r\n            });\r\n        attrsService.track($scope, $attrs, 'myProductListKey', vm, onProductKeyChanged);\r\n    }\r\n\r\n    function addProduct(ewfFormCtrl, productForm) {\r\n        if (isValid(ewfFormCtrl, productForm)) {\r\n            removeEmptyCommodityCodeItems();\r\n            ewfCrudService.addElement(productUrl, vm.product)\r\n                .then(() => {\r\n                    resetProductDefaults();\r\n                    resetForm(ewfFormCtrl, productForm);\r\n                    attrsService.trigger($scope, $attrs, 'onProductAdded');\r\n                })\r\n                .catch((response) => {\r\n                    onError(response, ewfFormCtrl);\r\n                })\r\n                .finally(() => {\r\n                    if (!vm.product.importCommodityCodesList.length) {\r\n                        addNewCommodityCode();\r\n                    }\r\n                });\r\n        }\r\n    }\r\n\r\n    function updateProduct(ewfFormCtrl, productForm) {\r\n        if (isValid(ewfFormCtrl, productForm)) {\r\n            removeEmptyCommodityCodeItems();\r\n            ewfCrudService.changeElement(productUrl, vm.product)\r\n                .then(() => {\r\n                    resetProductDefaults();\r\n                    resetForm(ewfFormCtrl, productForm);\r\n                    attrsService.trigger($scope, $attrs, 'onProductEdited');\r\n                })\r\n                .catch((response) => {\r\n                    onError(response, ewfFormCtrl);\r\n                })\r\n                .finally(() => {\r\n                    if (!vm.product.importCommodityCodesList.length) {\r\n                        addNewCommodityCode();\r\n                    }\r\n                });\r\n        }\r\n    }\r\n\r\n    function cancelForm(ewfFormCtrl, productForm) {\r\n        resetProductDefaults();\r\n        resetForm(ewfFormCtrl, productForm);\r\n        attrsService.trigger($scope, $attrs, 'onEditCanceled');\r\n    }\r\n\r\n    function isValid(ewfFormCtrl, productForm) {\r\n        ewfFormCtrl.ewfValidation();\r\n        return productForm.$valid;\r\n    }\r\n\r\n    function getUomAndCurrency() {\r\n        profileShipmentService.getDefaultSomAndCurrency()\r\n            .then((response) => {\r\n                productDefaults.currency = response.defaultCurrency;\r\n                vm.currencyList = response.defaultCurrencyList;\r\n                vm.hasUnitsList = response.somList && response.somList.length > 1;\r\n                if (response.som === 'IMPERIAL') {\r\n                    productDefaults.weightUnits = 'LB';\r\n                }\r\n                resetProductDefaults();\r\n            });\r\n    }\r\n\r\n    function resetProductDefaults() {\r\n        vm.product = angular.copy(productDefaults);\r\n        vm.product.importCommodityCodesList = [getEmptyImportCommodityCode()];\r\n    }\r\n\r\n    function resetForm(ewfFormCtrl, productForm) {\r\n        $timeout(() => {\r\n            ewfFormCtrl.cleanAllFieldErrors();\r\n            ewfFormCtrl.cleanFormErrors();\r\n            productForm.$setPristine();\r\n        });\r\n    }\r\n\r\n    function onProductKeyChanged(productKey) {\r\n        vm.isEditMode = false;\r\n        if (productKey) {\r\n            vm.isEditMode = true;\r\n            ewfCrudService.getElementDetails(productUrl, productKey)\r\n                .then((response) => {\r\n                    Object.assign(vm.product, response);\r\n                    if (!vm.product.importCommodityCodesList.length) {\r\n                        addNewCommodityCode();\r\n                    }\r\n                });\r\n        }\r\n    }\r\n\r\n    function onError(response, ewfFormCtrl) {\r\n        if (response.data) {\r\n            ewfFormCtrl.setErrorsFromResponse(response.data);\r\n        } else {\r\n            ewfFormCtrl.setErrorsFromResponse({\r\n                errors: ['errors.server_error']\r\n            });\r\n        }\r\n    }\r\n\r\n    function removeEmptyCommodityCodeItems() {\r\n        vm.product.importCommodityCodesList = vm.product.importCommodityCodesList.filter((commodityCodeItem) => {\r\n            return commodityCodeItem.commodityCode.trim() !== '' && commodityCodeItem.countryCode.trim() !== '';\r\n        });\r\n    }\r\n\r\n    function canAddCommodityCode() {\r\n        return vm.product.importCommodityCodesList.every((eachCodeInfo) => {\r\n            const codeAndCountryDefined = !!(eachCodeInfo.commodityCode && eachCodeInfo.countryCode);\r\n            let codeAndCountryPresent = false;\r\n            if (codeAndCountryDefined) {\r\n                codeAndCountryPresent = eachCodeInfo.commodityCode.trim().length ||\r\n                    eachCodeInfo.countryCode.trim().length;\r\n            }\r\n            return codeAndCountryDefined && codeAndCountryPresent;\r\n        });\r\n    }\r\n\r\n    function canShowRemoveButton() {\r\n        return vm.product.importCommodityCodesList.length > 1;\r\n    }\r\n\r\n    function getEmptyImportCommodityCode() {\r\n        return Object.assign({}, emptyImportCommodityCode);\r\n    }\r\n\r\n    function addNewCommodityCode() {\r\n        vm.product.importCommodityCodesList.push(getEmptyImportCommodityCode());\r\n    }\r\n\r\n    function removeCommodityCode(index) {\r\n        vm.product.importCommodityCodesList.splice(index, 1);\r\n        if (vm.product.importCommodityCodesList.length === 0) {\r\n            addNewCommodityCode();\r\n        }\r\n    }\r\n\r\n    function clearCountryCode(item, $event) {\r\n        const enterKeyCode = 13;\r\n        if ($event.keyCode === enterKeyCode) {\r\n            return;\r\n        }\r\n        item.countryCode = '';\r\n    }\r\n\r\n    function productCountryTypeaheadOnSelect($item) {\r\n        vm.product.countryCode = $item.code2;\r\n        $timeout(() => {\r\n            vm.product.countryName = $item.name;\r\n        });\r\n    }\r\n\r\n    function countryTypeaheadOnSelect($item, $index) {\r\n        vm.product.importCommodityCodesList[$index].countryCode = $item.code2;\r\n        $timeout(() => {\r\n            vm.product.importCommodityCodesList[$index].countryName = $item.name;\r\n        });\r\n    }\r\n}\r\n"],"sourceRoot":"/source/"}