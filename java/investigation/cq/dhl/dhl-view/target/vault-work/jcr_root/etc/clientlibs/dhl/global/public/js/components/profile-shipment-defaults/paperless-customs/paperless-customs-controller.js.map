{"version":3,"sources":["components/profile-shipment-defaults/paperless-customs/paperless-customs-controller.js"],"names":[],"mappings":"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","file":"components/profile-shipment-defaults/paperless-customs/paperless-customs-controller.js","sourcesContent":["import './../../../constants/system-settings-constants';\r\nimport './../../../services/ewf-crud-service';\r\nimport './../../../services/modal/modal-service';\r\n\r\nPaperlessCustomsController.$inject = [\r\n    '$q',\r\n    '$timeout',\r\n    'systemSettings',\r\n    'ewfCrudService',\r\n    'modalService'\r\n];\r\n\r\nexport default function PaperlessCustomsController($q, $timeout, systemSettings, ewfCrudService, modalService) {\r\n    const CUSTOMS_ENDPOINT = '/api/myprofile/customs';\r\n    const PAPERLESS_SETTINGS_ENDPOINT = `${CUSTOMS_ENDPOINT}/paperless`;\r\n    const PAPERLESS_STATUS_ENDPOINT = `${PAPERLESS_SETTINGS_ENDPOINT}/status`;\r\n\r\n    const GENERATED = {\r\n        OWN: 'OWN',\r\n        DHL: 'DHL'\r\n    };\r\n\r\n    const vm = this;\r\n\r\n    Object.assign(vm, {\r\n        settings: {},\r\n        errors: {\r\n            signature: [],\r\n            logo: []\r\n        },\r\n        actionStatus: {\r\n            displayErrors: false\r\n        },\r\n        generated: GENERATED,\r\n        enrollmentRequest: false,\r\n        isPaperlessHelpShown: false,\r\n\r\n        loadSettings,\r\n        updateSettings,\r\n        isEnrollmentDisplayed,\r\n        isTermsAgreementDisplayed,\r\n        isSignatureRequiredError,\r\n        enablePaperless,\r\n        pausePaperless,\r\n        acceptTermsConditions,\r\n        termsConditionsPopup,\r\n        signatureUploaded,\r\n        logoUploaded,\r\n        fileUploadError,\r\n        removeImage,\r\n        togglePaperlessHelp\r\n    });\r\n\r\n    function loadSettings() {\r\n        ewfCrudService.getElementList(PAPERLESS_SETTINGS_ENDPOINT)\r\n            .then((response) => {\r\n                Object.assign(vm.settings, response);\r\n            });\r\n    }\r\n\r\n    function updateSettings(ewfFormController) {\r\n        let promise;\r\n        if (ewfFormController.ewfValidation() && isValid()) {\r\n            const params = {};\r\n\r\n            Object.assign(params, vm.settings);\r\n\r\n            if (vm.settings.logo) {\r\n                params.logo = vm.settings.logo.key;\r\n            }\r\n\r\n            if (vm.settings.signature) {\r\n                params.signature = vm.settings.signature.key;\r\n            }\r\n\r\n            promise = ewfCrudService.updateElement(PAPERLESS_SETTINGS_ENDPOINT, params);\r\n        } else {\r\n            vm.actionStatus.displayErrors = true;\r\n            promise = $q.reject();\r\n        }\r\n        return promise;\r\n    }\r\n\r\n    function isValid() {\r\n        if (vm.settings.generatedBy === GENERATED.DHL) {\r\n            return vm.signerForm.$valid && !!vm.settings.signature;\r\n        }\r\n        return vm.settings.generatedBy === GENERATED.OWN;\r\n    }\r\n\r\n    function togglePaperlessHelp() {\r\n        vm.isPaperlessHelpShown = !vm.isPaperlessHelpShown;\r\n    }\r\n\r\n    function isSignatureRequiredError() {\r\n        return vm.settings.generatedBy === GENERATED.DHL && !vm.settings.signature && vm.actionStatus.displayErrors;\r\n    }\r\n\r\n    function isEnrollmentDisplayed() {\r\n        return !!(vm.settings.enrolled || vm.enrollmentRequest);\r\n    }\r\n\r\n    function isTermsAgreementDisplayed() {\r\n        return !!(vm.settings.generatedBy && !vm.settings.enrolled);\r\n    }\r\n\r\n    function enablePaperless() {\r\n        return changePaperlessStatus(true);\r\n    }\r\n\r\n    function pausePaperless() {\r\n        return changePaperlessStatus(false);\r\n    }\r\n\r\n    function changePaperlessStatus(status) {\r\n        return ewfCrudService.changeElement(PAPERLESS_STATUS_ENDPOINT, {enabled: status})\r\n            .then(() => vm.settings.enabled = status);\r\n    }\r\n\r\n    function acceptTermsConditions(ewfFormController) {\r\n        vm.settings.enabled = true;\r\n        return vm.updateSettings(ewfFormController)\r\n            .then(onSuccessfulEnrollment);\r\n    }\r\n\r\n    function termsConditionsPopup() {\r\n        modalService.showDialog({\r\n            closeOnEsc: true,\r\n            windowClass: 'ngdialog-theme-default',\r\n            template:'<ewf-modal dialog-width=large><ewf-paperless-customs-terms-conditions></ewf-paperless-customs-terms-conditions></ewf-modal>'\r\n        });\r\n    }\r\n\r\n    function onSuccessfulEnrollment() {\r\n        vm.actionStatus.enrolled = true;\r\n        vm.settings.enrolled = true;\r\n        vm.enrollmentRequest = false;\r\n        $timeout(() => {\r\n                vm.actionStatus.enrolled = false;\r\n            },\r\n            systemSettings.showInformationHintTimeout\r\n        );\r\n    }\r\n\r\n    function signatureUploaded(signature) {\r\n        vm.errors.signature = [];\r\n        vm.settings.signature = signature;\r\n    }\r\n\r\n    function logoUploaded(logo) {\r\n        vm.errors.logo = [];\r\n        vm.settings.logo = logo;\r\n    }\r\n\r\n    function fileUploadError({errors, type}) {\r\n        vm.errors[type] = errors || [];\r\n\r\n        if (vm.errors[type].length === 0) {\r\n            vm.errors[type].push('errors.uploaded_file_failed');\r\n        }\r\n\r\n        $timeout(() => {\r\n                vm.errors[type] = [];\r\n            },\r\n            systemSettings.showInformationHintTimeout\r\n        );\r\n    }\r\n\r\n    function removeImage(type) {\r\n        vm.settings[type] = null;\r\n    }\r\n}\r\n"],"sourceRoot":"/source/"}