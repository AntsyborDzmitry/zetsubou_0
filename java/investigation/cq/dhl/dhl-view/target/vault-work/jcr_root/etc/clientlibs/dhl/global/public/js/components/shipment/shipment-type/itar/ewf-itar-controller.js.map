{"version":3,"sources":["components/shipment/shipment-type/itar/ewf-itar-controller.js"],"names":[],"mappings":"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","file":"components/shipment/shipment-type/itar/ewf-itar-controller.js","sourcesContent":["import './ewf-itar-service';\r\nimport './../../ewf-shipment-service';\r\nimport './ewf-itar-service';\r\nimport './../../../../services/nls-service';\r\nimport './../../../../services/modal/modal-service';\r\nimport './../../../../services/config-service';\r\n\r\nItarController.$inject = ['$scope',\r\n                          '$filter',\r\n                          'nlsService',\r\n                          'configService',\r\n                          'modalService',\r\n                          'shipmentService',\r\n                          'itarService'];\r\n\r\nexport default function ItarController($scope,\r\n                                       $filter,\r\n                                       nlsService,\r\n                                       configService,\r\n                                       modalService,\r\n                                       shipmentService,\r\n                                       itarService) {\r\n    const vm = this;\r\n\r\n    const shipmentExportTypes = {\r\n        FTR: 'FTR',\r\n        ITN: 'ITN',\r\n        EEI: 'EEI',\r\n        EIN: 'EIN'\r\n    };\r\n    let country;\r\n    let displayItar = false;\r\n\r\n    Object.assign(vm, {\r\n        init,\r\n        getItar,\r\n        showItar,\r\n        isNotFederalRegulations,\r\n        openFtrCodesPopup,\r\n\r\n        itnNumber: '',\r\n        einNumber: '',\r\n        PATTERNS: {\r\n            ITN: '^([x,X]\\\\d{14})?$',\r\n            exportLicenseNumber: '^([a-zA-Z0-9]{1,23})?$',\r\n            ultimateConsignee: '^([a-zA-Z0-9]{1,35})?$',\r\n            EIN: '^(\\\\d{9}([a-zA-Z]{2}|\\\\d{2}))?$'\r\n        },\r\n        stateDepartmentFields: {\r\n            exportLicenseNumber: '',\r\n            ultimateConsignee: ''\r\n        },\r\n        departmentOfStateChosen: {\r\n            YES: 'yes',\r\n            NO: 'no'\r\n        },\r\n        shipmentExportType: '',\r\n        shipmentExportTypes,\r\n        shipmentExportTypesList: [{\r\n            value: '',\r\n            nlsKey: 'shipment.shipment_type_itar_select_one'\r\n        }, {\r\n            value: shipmentExportTypes.FTR,\r\n            nlsKey: 'shipment.shipment_type_itar_ftr_option'\r\n        }, {\r\n            value: shipmentExportTypes.ITN,\r\n            nlsKey: 'shipment.shipment_type_itar_itn_option'\r\n        }, {\r\n            value: shipmentExportTypes.EEI,\r\n            nlsKey: 'shipment.shipment_type_itar_eei_option'\r\n        }]\r\n    });\r\n\r\n    function init() {\r\n        country = shipmentService.getShipmentCountry();\r\n        itarService.getEnableItarValue(country)\r\n            .then((enableItar) => {\r\n                displayItar = enableItar;\r\n            });\r\n        itarService.getItarDetails(shipmentService.getDestinationCountry())\r\n            .then(onGetItarDetails)\r\n            .catch(onError);\r\n    }\r\n\r\n    function onGetItarDetails(itarDetails) {\r\n        showDescriptionWithCriticalValue();\r\n        setItnLink();\r\n\r\n        vm.ftrExemptionList = itarDetails.ftrExemptionList;\r\n        vm.employeeIdAvailable = itarDetails.employeeIdentificationNumberAvailable;\r\n    }\r\n\r\n    function showDescriptionWithCriticalValue() {\r\n        itarService.getCriticalShipmentItem(country)\r\n            .then((criticalPrice) => {\r\n                vm.notDepartmentOfStateDescription = nlsService\r\n                    .getTranslationSync('shipment.shipment_type_itar_not_department_of_state_description')\r\n                    .replace('{number}', $filter('number')(criticalPrice));\r\n            });\r\n    }\r\n\r\n    function setItnLink() {\r\n        const key = 'Shipment Details.EEI.aes.url';\r\n        configService.getValue(key, country)\r\n            .then((info) => {\r\n                vm.itnLink = info.data.value;\r\n            });\r\n    }\r\n\r\n    function showItar() {\r\n        return displayItar;\r\n    }\r\n\r\n    function onError(error) {\r\n        vm.error = nlsService.getTranslationSync(error);\r\n    }\r\n\r\n    function getItar() {\r\n        let itar = null;\r\n        if (vm.isDepartmentOfState) {\r\n            itar = {\r\n                departmentOfState: true,\r\n                itn: `X${vm.itnNumber.slice(1)}`,\r\n                exportLicenseNumber: vm.stateDepartmentFields.exportLicenseNumber,\r\n                ultimateConsignee: vm.stateDepartmentFields.ultimateConsignee\r\n            };\r\n        } else if (vm.federalTradeRegulations) {\r\n            itar = {\r\n                departmentOfState: false,\r\n                federalTradeRegulations: true\r\n            };\r\n        } else if (vm.shipmentExportType === vm.shipmentExportTypes.FTR) {\r\n            itar = {\r\n                departmentOfState: false,\r\n                federalTradeRegulations: false,\r\n                exportFilingOption: vm.shipmentExportTypes.FTR,\r\n                ftrExemptions: vm.ftrExemptions.code\r\n            };\r\n        } else if (vm.shipmentExportType === vm.shipmentExportTypes.ITN) {\r\n            itar = {\r\n                departmentOfState: false,\r\n                federalTradeRegulations: false,\r\n                exportFilingOption: vm.shipmentExportTypes.ITN,\r\n                itn: `X${vm.itnNumber.slice(1)}`\r\n            };\r\n        } else if (vm.shipmentExportType === vm.shipmentExportTypes.EIN) {\r\n            itar = {\r\n                departmentOfState: false,\r\n                federalTradeRegulations: false,\r\n                exportFilingOption: vm.shipmentExportTypes.EIN,\r\n                employerIdentificationNumber: vm.einNumber,\r\n                aespostTermsAccepted: vm.aespostTermsAccepted\r\n            };\r\n        } else if (vm.shipmentExportType === vm.shipmentExportTypes.EEI) {\r\n            itar = {\r\n                departmentOfState: false,\r\n                federalTradeRegulations: false,\r\n                exportFilingOption: vm.shipmentExportTypes.EEI,\r\n                employerIdentificationNumber: vm.itarEeiCtrl.ein,\r\n                electronicExportInformation: {\r\n                    items: getComodityItems(),\r\n                    senderAndReceiverRelated: vm.itarEeiCtrl.isRelated\r\n                }\r\n            };\r\n        }\r\n        return itar;\r\n    }\r\n\r\n    function isNotFederalRegulations() {\r\n        return vm.isDepartmentOfState === false && vm.federalTradeRegulations === false;\r\n    }\r\n\r\n    function openFtrCodesPopup() {\r\n        modalService.showDialog({\r\n            closeOnEsc: true,\r\n            scope: $scope,\r\n            windowClass: 'ngdialog-theme-default ewf-modal_width_large',\r\n            template:'<div ewf-modal nls-title=shipment.shipment_type_itar_ftr_lookup_title_help><h4 nls=shipment.shipment_type_itar_ftr_lookup_title_ftr></h4><p nls=shipment.shipment_type_itar_ftr_lookup_ftr_definition></p><table class=\\\"table table_zebra\\\"><thead><tr><th nls=shipment.shipment_type_itar_table_ftr_label></th><th nls=shipment.shipment_type_itar_table_ftr_explanation_label></th></tr></thead><tbody><tr ng-repeat=\\\"exemption in itarCtrl.ftrExemptionList\\\"><td>{{exemption.code}}</td><td nls={{exemption.description}}></td></tr></tbody></table><p class=margin-bottom-none nls=shipment.shipment_type_itar_ftr_lookup_footnote></p></div>'\r\n        });\r\n    }\r\n\r\n    function getComodityItems() {\r\n        const items = vm.itarEeiCtrl.commodityList.map((commodityRow) => {\r\n            return {\r\n                description: commodityRow.description,\r\n                licenseType: commodityRow.licenseType,\r\n                licenseNumber: commodityRow.licenseNumber,\r\n                eccn: commodityRow.ECCN,\r\n                quantity: parseFloat(commodityRow.quantity),\r\n                units: commodityRow.quantityUnit,\r\n                exportCode: commodityRow.exportCode.value,\r\n                commodityOrigin: commodityRow.origin,\r\n                totalWeight: parseFloat(commodityRow.totalWeight),\r\n                totalValue: parseFloat(commodityRow.totalValue)\r\n            };\r\n        });\r\n\r\n        return items;\r\n    }\r\n}\r\n"],"sourceRoot":"/source/"}