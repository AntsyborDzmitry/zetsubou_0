{"version":3,"sources":["components/profile-settings/profile-rewards/profile-rewards-controller.js"],"names":[],"mappings":"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","file":"components/profile-settings/profile-rewards/profile-rewards-controller.js","sourcesContent":["import './profile-rewards-directive';\r\nimport './../../../services/ewf-crud-service';\r\n\r\nProfileRewardsController.$inject = ['$scope', '$q', 'ewfCrudService', 'logService'];\r\n\r\nexport default function ProfileRewardsController($scope, $q, ewfCrudService, logService) {\r\n    const vm = this;\r\n    const numOfFixedDigits = 8;\r\n    const defaultRewardFirstPart = '98263000';\r\n    const defaultRewardSecondPart = '00000000000';\r\n    const rewardProgramURL = 'https://www.nectar.com/register/consumer/enrol.htm';\r\n\r\n    Object.assign(vm, {\r\n        profileReward: '',\r\n        errorMessages: [],\r\n        profileRewardFirstPart: defaultRewardFirstPart,\r\n        showRewardProgramForNewUser: true,\r\n        patterns: {\r\n            numeric: '^(\\\\s*|\\\\d+)$'\r\n        },\r\n\r\n        rewardProgramURL,\r\n        defaultRewardSecondPart,\r\n        updateRewardNumber\r\n    });\r\n\r\n    ewfCrudService.getElementDetails('/api/myprofile/rewards')\r\n        .then((response) => {\r\n            let profileReward = response;\r\n            vm.profileReward = profileReward.rewardsCardNumber.replace('\\\"', '');\r\n            vm.profileReward = vm.profileReward.replace('\\\"', '');\r\n            if (response !== '' && response !== '\"\"') {\r\n                let length = vm.profileReward.length;\r\n                if (length > numOfFixedDigits) {\r\n                    vm.profileRewardFirstPart = vm.profileReward.substring(0, numOfFixedDigits);\r\n                    vm.profileRewardSecondPart = vm.profileReward.substring(numOfFixedDigits, length);\r\n                    vm.showRewardProgramForNewUser = false;\r\n                }\r\n            }\r\n        })\r\n        .catch((err) => {\r\n            logService.error(err);\r\n            $q.reject(err);\r\n        });\r\n\r\n    function updateRewardNumber() {\r\n\r\n        const rewardObject = getRewardObject(vm.profileRewardSecondPart ?\r\n            vm.profileRewardFirstPart + vm.profileRewardSecondPart : '');\r\n\r\n        const rewardNumberPromise = ewfCrudService.updateElement('/api/myprofile/rewards', rewardObject);\r\n        rewardNumberPromise\r\n            .then((response) => {\r\n                vm.rewardNumberResponse = response;\r\n                vm.showRewardProgramForNewUser = false;\r\n                vm.errorMessages = [];\r\n            })\r\n            .catch((err) => {\r\n                logService.error(err);\r\n                if (err.fieldErrors && err.fieldErrors.rewardsCardNumber\r\n                    && (err.fieldErrors.rewardsCardNumber instanceof Array)) {\r\n\r\n                        vm.errorMessages = err.fieldErrors.rewardsCardNumber;\r\n                } else if (err.errors && (err.errors instanceof Array)) {\r\n                    vm.errorMessages = err.errors;\r\n                } else {\r\n                    vm.errorMessages.push(err.errors ? err.errors : 'internal error ');\r\n                }\r\n                $q.reject(err);\r\n            });\r\n    }\r\n\r\n    function getRewardObject(rewardsNumber) {\r\n        return {\r\n            rewardsCardNumber: rewardsNumber\r\n        };\r\n    }\r\n}\r\n"],"sourceRoot":"/source/"}