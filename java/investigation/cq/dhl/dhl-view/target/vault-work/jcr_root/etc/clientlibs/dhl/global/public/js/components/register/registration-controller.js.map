{"version":3,"sources":["components/register/registration-controller.js"],"names":[],"mappings":";;;;qBAKwB,sBAAsB;;AAF9C,0BAAsB,CAAC,OAAO,GAAG,CAAC,UAAU,EAAE,IAAI,EAAE,mBAAmB,EAAE,YAAY,EAAE,qBAAqB,CAAC,CAAC;;AAE/F,aAAS,sBAAsB,CAAC,QAAQ,EAAE,EAAE,EAAE,iBAAiB,EAAE,UAAU,EAAE,mBAAmB,EAAE;AAC7G,YAAM,EAAE,GAAG,IAAI,CAAC;;AAEhB,YAAM,WAAW,GAAG,QAAQ,CAAC;AAC7B,YAAM,SAAS,GAAG,MAAM,CAAC;AACzB,YAAM,eAAe,GAAG,cAAc,CAAC;AACvC,YAAM,kBAAkB,GAAG,IAAI,CAAC;AAChC,YAAM,SAAS,GAAG,iBAAiB,CAAC;;AAEpC,cAAM,CAAC,MAAM,CAAC,EAAE,EAAE;AACd,2BAAe,EAAf,eAAe;AACf,2BAAe,EAAf,eAAe;AACf,2BAAe,EAAf,eAAe;AACf,+BAAmB,EAAnB,mBAAmB;AACnB,yCAA6B,EAA7B,6BAA6B;;AAE7B,uBAAW,EAAE,SAAS;AACtB,6BAAiB,EAAE,EAAE;SACxB,CAAC,CAAC;;AAEH,YAAM,iBAAiB,GAAG,kBAAkB,CAAC,cAAc,CAAC,CAAC;AAC7D,YAAI,iBAAiB,EAAE;AACnB,yCAA6B,EAAE,CAAC;SACnC;;AAED,iBAAS,eAAe,CAAC,OAAO,EAAE;AAC9B,mBAAO,mBAAmB,CAAC,eAAe,CAAC,OAAO,CAAC,CAC9C,IAAI,CAAC,UAAC,YAAY,EAAK;;AAEpB,kBAAE,CAAC,WAAW,GAAG,WAAW,CAAC;AAC7B,kBAAE,CAAC,iBAAiB,GAAG,YAAY,CAAC;AACpC,uBAAO,YAAY,CAAC;aACvB,CAAC,SACI,CAAC,UAAC,KAAK,EAAK;AACd,0BAAU,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;AACxB,uBAAO,EAAE,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;aAC3B,CAAC,CAAC;SACV;;AAED,iBAAS,eAAe,GAAG;AACvB,mBAAO,EAAE,CAAC,iBAAiB,CAAC;SAC/B;;AAED,iBAAS,eAAe,GAAG;AACvB,mBAAO,mBAAmB,CAAC,WAAW,CAAC,iBAAiB,CAAC,CACpD,IAAI,CAAC,YAAM;AACR,wBAAQ,CAAC,YAAM;AACX,qCAAiB,CAAC,QAAQ,CAAC,SAAS,CAAC,CAAC;iBACzC,EAAE,kBAAkB,CAAC,CAAC;aAC1B,CAAC,CAAC;SACV;;AAED,iBAAS,mBAAmB,GAAG;AAC3B,mBAAO,mBAAmB,CAAC,0BAA0B,CAAC,iBAAiB,CAAC,CACnE,IAAI,CAAC,UAAC,YAAY,EAAK;AACpB,kBAAE,CAAC,iBAAiB,GAAG,YAAY,CAAC;AACpC,uBAAO,YAAY,CAAC;aACvB,CAAC,CAAC;SACV;;AAED,iBAAS,6BAA6B,GAAG;AACrC,cAAE,CAAC,WAAW,GAAG,eAAe,CAAC;SACpC;;AAED,iBAAS,kBAAkB,CAAC,SAAS,EAAE;AACnC,gBAAM,IAAI,GAAG,SAAS,CAAC,OAAO,CAAC,MAAM,EAAE,KAAK,CAAC,CAAC,OAAO,CAAC,MAAM,EAAE,KAAK,CAAC,CAAC;AACrE,gBAAM,KAAK,GAAG,IAAI,MAAM,CAAC,QAAQ,GAAG,IAAI,GAAG,WAAW,CAAC,CAAC;AACxD,gBAAM,OAAO,GAAG,KAAK,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;;AAE5C,mBAAO,OAAO,KAAK,IAAI,GAAG,EAAE,GAAG,kBAAkB,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,KAAK,EAAE,GAAG,CAAC,CAAC,CAAC;SACrF;KACJ","file":"components/register/registration-controller.js","sourcesContent":["/* global location */\r\nimport './registration-service';\r\n\r\nRegistrationController.$inject = ['$timeout', '$q', 'navigationService', 'logService', 'registrationService'];\r\n\r\nexport default function RegistrationController($timeout, $q, navigationService, logService, registrationService) {\r\n    const vm = this;\r\n\r\n    const RESULT_STEP = 'result';\r\n    const FORM_STEP = 'form';\r\n    const ACTIVATION_STEP = 'verification';\r\n    const ACTIVATION_TIMEOUT = 3333;\r\n    const LOGIN_URL = 'auth/login.html';\r\n\r\n    Object.assign(vm, {\r\n        registerNewUser,\r\n        getActivationId,\r\n        activateAccount,\r\n        renewActivationLink,\r\n        navigateToEmailActivationPage,\r\n\r\n        currentStep: FORM_STEP,\r\n        emailActivationId: ''\r\n    });\r\n\r\n    const activationIdParam = getParameterByName('activationId');\r\n    if (activationIdParam) {\r\n        navigateToEmailActivationPage();\r\n    }\r\n\r\n    function registerNewUser(newUser) {\r\n        return registrationService.registerNewUser(newUser)\r\n            .then((activationId) => {\r\n                // go to next step\r\n                vm.currentStep = RESULT_STEP;\r\n                vm.emailActivationId = activationId;\r\n                return activationId;\r\n            })\r\n            .catch((error) => {\r\n                logService.error(error);\r\n                return $q.reject(error);\r\n            });\r\n    }\r\n\r\n    function getActivationId() {\r\n        return vm.emailActivationId;\r\n    }\r\n\r\n    function activateAccount() {\r\n        return registrationService.verifyEmail(activationIdParam)\r\n            .then(() => {\r\n                $timeout(() => {\r\n                    navigationService.location(LOGIN_URL);\r\n                }, ACTIVATION_TIMEOUT);\r\n            });\r\n    }\r\n\r\n    function renewActivationLink() {\r\n        return registrationService.renewExpiredActivationLink(activationIdParam)\r\n            .then((activationId) => {\r\n                vm.emailActivationId = activationId;\r\n                return activationId;\r\n            });\r\n    }\r\n\r\n    function navigateToEmailActivationPage() {\r\n        vm.currentStep = ACTIVATION_STEP;\r\n    }\r\n\r\n    function getParameterByName(paramName) {\r\n        const name = paramName.replace(/[\\[]/, '\\\\[').replace(/[\\]]/, '\\\\]');\r\n        const regex = new RegExp('[\\\\?&]' + name + '=([^&#]*)');\r\n        const results = regex.exec(location.search);\r\n\r\n        return results === null ? '' : decodeURIComponent(results[1].replace(/\\+/g, ' '));\r\n    }\r\n}\r\n"],"sourceRoot":"/source/"}