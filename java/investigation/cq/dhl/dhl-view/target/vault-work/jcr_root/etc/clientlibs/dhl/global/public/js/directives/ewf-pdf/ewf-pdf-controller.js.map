{"version":3,"sources":["directives/ewf-pdf/ewf-pdf-controller.js"],"names":[],"mappings":";;;qBAEwB,gBAAgB;;;;;;AADxC,oBAAgB,CAAC,OAAO,GAAG,CAAC,QAAQ,EAAE,SAAS,EAAE,YAAY,CAAC,CAAC;;AAChD,aAAS,gBAAgB,CAAC,MAAM,EAAE,OAAO,EAAE,UAAU,EAAE;AAClE,YAAM,EAAE,GAAG,IAAI,CAAC;;AAEhB,YAAM,YAAY,GAAG,GAAG,CAAC;;AAEzB,UAAE,CAAC,WAAW,GAAG,OAAO,CAAC,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,iBAAiB,CAAC,CAAC;;;;;AAKhE,YAAM,GAAG,GAAG,IAAI,UAAU,CAAC,IAAI,WAAW,CAAC,EAAE,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC,CAAC;;AAEnE,aAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,EAAE,CAAC,WAAW,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;AAC5C,eAAG,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC,WAAW,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;SACzC;;AAED,eAAO,CAAC,KAAK,GAAG,qBAAS,OAAO,CAAC,KAAK,CAAC;AACvC,eAAO,CAAC,KAAK,CAAC,WAAW,CAAC,GAAG,CAAC,CACzB,IAAI,CAAC,UAAS,GAAG,EAAE;AAChB,eAAG,CAAC,OAAO,CAAC,CAAC,CAAC,CACT,IAAI,CAAC,UAAS,IAAI,EAAE;AACjB,oBAAM,QAAQ,GAAG,IAAI,CAAC,WAAW,CAAC,YAAY,GAAG,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC,KAAK,CAAC,CAAC;;AAE9E,oBAAM,MAAM,GAAG,EAAE,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;AAC5B,oBAAM,OAAO,GAAG,MAAM,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;AACxC,sBAAM,CAAC,MAAM,GAAG,QAAQ,CAAC,MAAM,CAAC;AAChC,sBAAM,CAAC,KAAK,GAAG,QAAQ,CAAC,KAAK,CAAC;;AAE9B,oBAAM,aAAa,GAAG;AAClB,iCAAa,EAAE,OAAO;AACtB,4BAAQ,EAAR,QAAQ;iBACX,CAAC;AACF,oBAAI,CAAC,MAAM,CAAC,aAAa,CAAC,CAAC;aAC9B,CAAC,SACI,CAAC,UAAS,GAAG,EAAE;AACjB,0BAAU,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;aACvB,CAAC,CAAC;SACV,CAAC,SACI,CAAC,UAAS,GAAG,EAAE;AACjB,sBAAU,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;SACvB,CAAC,CAAC;KACV","file":"directives/ewf-pdf/ewf-pdf-controller.js","sourcesContent":["import PDFJS from 'pdfjs';\r\nEwfPdfController.$inject = ['$scope', '$window', 'logService'];\r\nexport default function EwfPdfController($scope, $window, logService) {\r\n    const vm = this;\r\n\r\n    const CANVAS_WIDTH = 420;\r\n\r\n    vm.pdfDocument = $window.atob($scope.$parent.previewedDocument);\r\n\r\n    //TODO: add polyfills for ie 9 for Uint8Array, ArrayBuffer and atob\r\n    //https://github.com/inexorabletash/polyfill/blob/master/typedarray.js\r\n    //https://github.com/davidchambers/Base64.js/blob/master/base64.js\r\n    const arr = new Uint8Array(new ArrayBuffer(vm.pdfDocument.length));\r\n\r\n    for (let i = 0; i < vm.pdfDocument.length; i++) {\r\n        arr[i] = vm.pdfDocument.charCodeAt(i);\r\n    }\r\n\r\n    $window.PDFJS = PDFJS || $window.PDFJS;\r\n    $window.PDFJS.getDocument(arr)\r\n        .then(function(pdf) {\r\n            pdf.getPage(1)\r\n                .then(function(page) {\r\n                    const viewport = page.getViewport(CANVAS_WIDTH / page.getViewport(1.0).width);\r\n\r\n                    const canvas = vm.canvas[0];\r\n                    const context = canvas.getContext('2d');\r\n                    canvas.height = viewport.height;\r\n                    canvas.width = viewport.width;\r\n\r\n                    const renderContext = {\r\n                        canvasContext: context,\r\n                        viewport\r\n                    };\r\n                    page.render(renderContext);\r\n                })\r\n                .catch(function(err) {\r\n                    logService.log(err);\r\n                });\r\n        })\r\n        .catch(function(err) {\r\n            logService.log(err);\r\n        });\r\n}\r\n"],"sourceRoot":"/source/"}